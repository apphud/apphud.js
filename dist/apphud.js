<<<<<<< HEAD
window.ApphudSDKVersion="2.0.0",function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).apphud=t()}(this,(function(){"use strict";var e=function(){return e=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},e.apply(this,arguments)};function t(e,t,i,r){return new(i||(i=Promise))((function(n,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))}function i(e,t){var i,r,n,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(i)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(i=1,r&&(n=2&s[0]?r.return:s[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,s[1])).done)return n;switch(r=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(n=o.trys,(n=n.length>0&&n[n.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){o.label=s[1];break}if(6===s[0]&&o.label<n[1]){o.label=n[1],n=s;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(s);break}n[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{i=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}"function"==typeof SuppressedError&&SuppressedError;var r=function(e,t,i){var r="";if(i){var n=new Date;n.setTime(n.getTime()+60*i*1e3),r="; expires="+n.toGMTString()}document.cookie=e+"="+encodeURIComponent(t)+r+"; path=/; samesite=lax"},n=function(e){var t,i,r=e+"=",n=document.cookie.split(";");for(t=0;t<n.length;t++){for(i=n[t];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(r))return decodeURIComponent(i.substring(r.length,i.length))}return null},o=function(e){r(e,"",-1)},a={apiKey:"",baseURL:"https://api.apphud.com/v1",baseSuccessURL:"https://getapp.apphud.com",debug:!1,websiteVersion:"0.0.1",httpRetriesCount:3,language:"en",httpRetryDelay:1e3,redirectDelay:1e3,headers:{},stripeLiveKey:"pk_live_4iYTlDlSJeqsh5ZAZNuDsLte004vt1l4tS",stripeTestKey:"pk_test_leENTjttGVwRY2ZkCk0UaaiG00oeNHfn4o",disableCookies:!1},s="undefined"!=typeof JSON&&void 0!==JSON.stringify,u=function(){for(var e,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];a.debug&&(e=window.console).log.apply(e,t)},c=function(){for(var e,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var r=!1;if(t.length>0&&"boolean"==typeof t[t.length-1]&&(r=t.pop()),(e=window.console).error.apply(e,t),r&&C.reportError){var n=t.map((function(e){if("object"==typeof e)try{return JSON.stringify(e)}catch(t){return String(e)}return String(e)})).join(" ");C.reportError(n).catch((function(e){console.error("Failed to report error to backend:",e)}))}},l=function(e){"interactive"===document.readyState||"complete"===document.readyState?setTimeout(e,0):document.addEventListener("DOMContentLoaded",e)},d=function(e,t){var i=e[a.language];if(i||(i=e.en),!i){var r=Object.keys(e);r.length>0&&(i=e[r[0]])}return i?t.split(".").reduce((function(e,t){return e&&e[t]}),i):null},p=function(e){return t(void 0,void 0,void 0,(function(){var t,r,n;return i(this,(function(i){switch(i.label){case 0:return t=new TextEncoder,r=t.encode(e),[4,crypto.subtle.digest("SHA-256",r)];case 1:return n=i.sent(),[2,Array.from(new Uint8Array(n)).map((function(e){return e.toString(16).padStart(2,"0")})).join("")]}}))}))},h=function(){try{if("undefined"!=typeof window&&window.amplitude&&"function"==typeof window.amplitude.getDeviceId)return window.amplitude.getDeviceId()}catch(e){c("Error getting Amplitude device ID:",e)}return null},f=function(e){return new Promise((function(t){return setTimeout(t,e)}))},m=l,v=function(){return window.crypto&&window.crypto.randomUUID?window.crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},b=function(){return navigator.language},y=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},w=function(){var e=navigator.language;return new Intl.NumberFormat(e,{style:"currency",currency:"USD"}).resolvedOptions().currency},g=function(){var e=Intl.DateTimeFormat().resolvedOptions().locale;return(e.split("-")[1]||e.split("-")[0]).toUpperCase()},P=function(){var e=navigator.userAgent,t="Unknown OS Version";if(-1!==e.indexOf("Windows NT")){var i=e.match(/Windows NT (\d+\.\d+)/);i&&(t="Windows "+i[1])}else if(-1!==e.indexOf("Mac OS X")){var r=e.match(/Mac OS X (\d+_\d+(_\d+)?)/);r&&(t="macOS "+r[1].replace(/_/g,"."))}else if(-1!==e.indexOf("iPhone OS")||-1!==e.indexOf("iPad; CPU OS")){var n=e.match(/OS (\d+_\d+(_\d+)?)/);n&&(t="iOS "+n[1].replace(/_/g,"."))}else if(-1!==e.indexOf("Android")){var o=e.match(/Android (\d+\.\d+(\.\d+)?)/);o&&(t="Android "+o[1])}else-1!==e.indexOf("Linux")&&(t="Linux");return t},_=function(){return(new Date).getTime()/1e3},k=d,S=function(){return a.baseURL+"/customers"},E=function(){return a.baseURL+"/events"},I=function(e){return a.baseURL+"/customers/attribution?"+e},x=function(e){return a.baseURL+"/payment_providers/:id/subscriptions".replace(":id",e)},O=function(e){return a.baseURL+"/payment_providers/:id/customers".replace(":id",e)},A=function(){return a.baseURL+"/analytics"},D=function(r,n,o){return t(void 0,void 0,void 0,(function(){function s(u){return t(this,void 0,void 0,(function(){var t,c,l,d,p;return i(this,(function(i){switch(i.label){case 0:t=a.httpRetryDelay||1e3,c=e({"Content-Type":"application/json; charset=utf-8",Authorization:"Bearer ".concat(a.apiKey)},a.headers),l={method:r,headers:c,credentials:"same-origin"},"POST"!==r&&"PUT"!==r||!o||(l.body=JSON.stringify(o)),i.label=1;case 1:return i.trys.push([1,4,,8]),[4,fetch(n,l)];case 2:if(!(d=i.sent()).ok)throw new Error("Network response was not ok");return[4,d.json()];case 3:return[2,i.sent()];case 4:return p=i.sent(),console.error("Attempt failed:",p),u<(a.httpRetriesCount||3)?[4,f(t)]:[3,6];case 5:return i.sent(),t*=2,[2,s(u+1)];case 6:throw console.error("All retries failed."),p;case 7:return[3,8];case 8:return[2]}}))}))}return i(this,(function(e){switch(e.label){case 0:return[4,s(0)];case 1:return[2,e.sent()]}}))}))},C={createUser:function(e){return t(void 0,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,D("POST",S(),e)];case 1:return[2,t.sent().data.results]}}))}))},createEvent:function(e){return t(void 0,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,D("POST",E(),e)];case 1:return[2,t.sent().data.results]}}))}))},baseHeaders:function(){return{"X-SDK":"web2web","X-SDK-VERSION":"2.0.0","X-Platform":"web2web","X-Store":"web2web","Content-Type":"application/json; charset=utf-8"}},createSubscription:function(e,r){return t(void 0,void 0,void 0,(function(){var t;return i(this,(function(i){switch(i.label){case 0:return[4,D("POST",x(e),r)];case 1:return(t=i.sent()).errors&&t.errors.length>0&&c("Subscription creation failed:",t.errors),[2,t.data.results]}}))}))},setAttribution:function(e,r){return t(void 0,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,D("POST",I(e),r)];case 1:return[2,t.sent().data.results]}}))}))},createCustomer:function(e,r){return t(void 0,void 0,void 0,(function(){var t;return i(this,(function(i){switch(i.label){case 0:return[4,D("POST",O(e),r)];case 1:return(t=i.sent()).errors&&t.errors.length>0&&c("Customer creation failed:",t.errors),[2,t.data.results]}}))}))},reportError:function(e){return t(void 0,void 0,void 0,(function(){var t;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,D("POST",A(),{error:e})];case 1:return i.sent(),[3,3];case 2:return t=i.sent(),c("Failed to report error to backend:",t),[3,3];case 3:return[2]}}))}))}},T="aph_start_version",U="aph_production_user_id",B="aph_debug_user_id",L="aph_events",z=1051200,F="data-aph-var",R="data-aph-upsell",j="aph_selected_bundle_index",N="aph_deep_link_url",q=1051200,M="aph_payment_provider",H="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function K(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var G={exports:{}};!function(e,t){!function(i,r){var n="function",o="undefined",a="object",s="string",u="major",c="model",l="name",d="type",p="vendor",h="version",f="architecture",m="console",v="mobile",b="tablet",y="smarttv",w="wearable",g="embedded",P="Amazon",_="Apple",k="ASUS",S="BlackBerry",E="Browser",I="Chrome",x="Firefox",O="Google",A="Huawei",D="LG",C="Microsoft",T="Motorola",U="Opera",B="Samsung",L="Sharp",z="Sony",F="Xiaomi",R="Zebra",j="Facebook",N="Chromium OS",q="Mac OS",M=" Browser",H=function(e){for(var t={},i=0;i<e.length;i++)t[e[i].toUpperCase()]=e[i];return t},K=function(e,t){return typeof e===s&&-1!==G(t).indexOf(G(e))},G=function(e){return e.toLowerCase()},V=function(e,t){if(typeof e===s)return e=e.replace(/^\s\s*/,""),typeof t===o?e:e.substring(0,500)},W=function(e,t){for(var i,o,s,u,c,l,d=0;d<t.length&&!c;){var p=t[d],h=t[d+1];for(i=o=0;i<p.length&&!c&&p[i];)if(c=p[i++].exec(e))for(s=0;s<h.length;s++)l=c[++o],typeof(u=h[s])===a&&u.length>0?2===u.length?typeof u[1]==n?this[u[0]]=u[1].call(this,l):this[u[0]]=u[1]:3===u.length?typeof u[1]!==n||u[1].exec&&u[1].test?this[u[0]]=l?l.replace(u[1],u[2]):r:this[u[0]]=l?u[1].call(this,l,u[2]):r:4===u.length&&(this[u[0]]=l?u[3].call(this,l.replace(u[1],u[2])):r):this[u]=l||r;d+=2}},Y=function(e,t){for(var i in t)if(typeof t[i]===a&&t[i].length>0){for(var n=0;n<t[i].length;n++)if(K(t[i][n],e))return"?"===i?r:i}else if(K(t[i],e))return"?"===i?r:i;return t.hasOwnProperty("*")?t["*"]:e},$={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Q={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[h,[l,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[h,[l,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[l,h],[/opios[\/ ]+([\w\.]+)/i],[h,[l,U+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[h,[l,U+" GX"]],[/\bopr\/([\w\.]+)/i],[h,[l,U]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[h,[l,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[h,[l,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[l,h],[/quark(?:pc)?\/([-\w\.]+)/i],[h,[l,"Quark"]],[/\bddg\/([\w\.]+)/i],[h,[l,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[h,[l,"UC"+E]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[h,[l,"WeChat"]],[/konqueror\/([\w\.]+)/i],[h,[l,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[h,[l,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[h,[l,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[h,[l,"Smart Lenovo "+E]],[/(avast|avg)\/([\w\.]+)/i],[[l,/(.+)/,"$1 Secure "+E],h],[/\bfocus\/([\w\.]+)/i],[h,[l,x+" Focus"]],[/\bopt\/([\w\.]+)/i],[h,[l,U+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[h,[l,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[h,[l,"Dolphin"]],[/coast\/([\w\.]+)/i],[h,[l,U+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[h,[l,"MIUI"+M]],[/fxios\/([\w\.-]+)/i],[h,[l,x]],[/\bqihoobrowser\/?([\w\.]*)/i],[h,[l,"360"]],[/\b(qq)\/([\w\.]+)/i],[[l,/(.+)/,"$1Browser"],h],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[l,/(.+)/,"$1"+M],h],[/samsungbrowser\/([\w\.]+)/i],[h,[l,B+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[h,[l,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[l,"Sogou Mobile"],h],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[l,h],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[l],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[h,l],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[l,j],h],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[l,h],[/\bgsa\/([\w\.]+) .*safari\//i],[h,[l,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[h,[l,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[h,[l,I+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[l,I+" WebView"],h],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[h,[l,"Android "+E]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[l,h],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[h,[l,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[h,l],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[l,[h,Y,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[l,h],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[l,"Netscape"],h],[/(wolvic|librewolf)\/([\w\.]+)/i],[l,h],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[h,[l,x+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[l,[h,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[l,[h,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[f,"amd64"]],[/(ia32(?=;))/i],[[f,G]],[/((?:i[346]|x)86)[;\)]/i],[[f,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[f,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[f,"armhf"]],[/windows (ce|mobile); ppc;/i],[[f,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[f,/ower/,"",G]],[/(sun4\w)[;\)]/i],[[f,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[f,G]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[c,[p,B],[d,b]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[c,[p,B],[d,v]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[c,[p,_],[d,v]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[c,[p,_],[d,b]],[/(macintosh);/i],[c,[p,_]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[c,[p,L],[d,v]],[/(?:honor)([-\w ]+)[;\)]/i],[c,[p,"Honor"],[d,v]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[c,[p,A],[d,b]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[c,[p,A],[d,v]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[c,/_/g," "],[p,F],[d,v]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[c,/_/g," "],[p,F],[d,b]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[c,[p,"OPPO"],[d,v]],[/\b(opd2\d{3}a?) bui/i],[c,[p,"OPPO"],[d,b]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[c,[p,"Vivo"],[d,v]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[c,[p,"Realme"],[d,v]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[c,[p,T],[d,v]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[c,[p,T],[d,b]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[c,[p,D],[d,b]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[c,[p,D],[d,v]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[c,[p,"Lenovo"],[d,b]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[c,/_/g," "],[p,"Nokia"],[d,v]],[/(pixel c)\b/i],[c,[p,O],[d,b]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[c,[p,O],[d,v]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[c,[p,z],[d,v]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[c,"Xperia Tablet"],[p,z],[d,b]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[c,[p,"OnePlus"],[d,v]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[c,[p,P],[d,b]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[c,/(.+)/g,"Fire Phone $1"],[p,P],[d,v]],[/(playbook);[-\w\),; ]+(rim)/i],[c,p,[d,b]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[c,[p,S],[d,v]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[c,[p,k],[d,b]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[c,[p,k],[d,v]],[/(nexus 9)/i],[c,[p,"HTC"],[d,b]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[p,[c,/_/g," "],[d,v]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[c,[p,"TCL"],[d,b]],[/(itel) ((\w+))/i],[[p,G],c,[d,Y,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[c,[p,"Acer"],[d,b]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[c,[p,"Meizu"],[d,v]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[c,[p,"Ulefone"],[d,v]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[c,[p,"Energizer"],[d,v]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[c,[p,"Cat"],[d,v]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[c,[p,"Smartfren"],[d,v]],[/droid.+; (a(?:015|06[35]|142p?))/i],[c,[p,"Nothing"],[d,v]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[p,c,[d,v]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[p,c,[d,b]],[/(surface duo)/i],[c,[p,C],[d,b]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[c,[p,"Fairphone"],[d,v]],[/(u304aa)/i],[c,[p,"AT&T"],[d,v]],[/\bsie-(\w*)/i],[c,[p,"Siemens"],[d,v]],[/\b(rct\w+) b/i],[c,[p,"RCA"],[d,b]],[/\b(venue[\d ]{2,7}) b/i],[c,[p,"Dell"],[d,b]],[/\b(q(?:mv|ta)\w+) b/i],[c,[p,"Verizon"],[d,b]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[c,[p,"Barnes & Noble"],[d,b]],[/\b(tm\d{3}\w+) b/i],[c,[p,"NuVision"],[d,b]],[/\b(k88) b/i],[c,[p,"ZTE"],[d,b]],[/\b(nx\d{3}j) b/i],[c,[p,"ZTE"],[d,v]],[/\b(gen\d{3}) b.+49h/i],[c,[p,"Swiss"],[d,v]],[/\b(zur\d{3}) b/i],[c,[p,"Swiss"],[d,b]],[/\b((zeki)?tb.*\b) b/i],[c,[p,"Zeki"],[d,b]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[p,"Dragon Touch"],c,[d,b]],[/\b(ns-?\w{0,9}) b/i],[c,[p,"Insignia"],[d,b]],[/\b((nxa|next)-?\w{0,9}) b/i],[c,[p,"NextBook"],[d,b]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[p,"Voice"],c,[d,v]],[/\b(lvtel\-)?(v1[12]) b/i],[[p,"LvTel"],c,[d,v]],[/\b(ph-1) /i],[c,[p,"Essential"],[d,v]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[c,[p,"Envizen"],[d,b]],[/\b(trio[-\w\. ]+) b/i],[c,[p,"MachSpeed"],[d,b]],[/\btu_(1491) b/i],[c,[p,"Rotor"],[d,b]],[/(shield[\w ]+) b/i],[c,[p,"Nvidia"],[d,b]],[/(sprint) (\w+)/i],[p,c,[d,v]],[/(kin\.[onetw]{3})/i],[[c,/\./g," "],[p,C],[d,v]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[c,[p,R],[d,b]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[c,[p,R],[d,v]],[/smart-tv.+(samsung)/i],[p,[d,y]],[/hbbtv.+maple;(\d+)/i],[[c,/^/,"SmartTV"],[p,B],[d,y]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[p,D],[d,y]],[/(apple) ?tv/i],[p,[c,_+" TV"],[d,y]],[/crkey/i],[[c,I+"cast"],[p,O],[d,y]],[/droid.+aft(\w+)( bui|\))/i],[c,[p,P],[d,y]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[c,[p,L],[d,y]],[/(bravia[\w ]+)( bui|\))/i],[c,[p,z],[d,y]],[/(mitv-\w{5}) bui/i],[c,[p,F],[d,y]],[/Hbbtv.*(technisat) (.*);/i],[p,c,[d,y]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[p,V],[c,V],[d,y]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[d,y]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[p,c,[d,m]],[/droid.+; (shield) bui/i],[c,[p,"Nvidia"],[d,m]],[/(playstation [345portablevi]+)/i],[c,[p,z],[d,m]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[c,[p,C],[d,m]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[c,[p,B],[d,w]],[/((pebble))app/i],[p,c,[d,w]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[c,[p,_],[d,w]],[/droid.+; (glass) \d/i],[c,[p,O],[d,w]],[/droid.+; (wt63?0{2,3})\)/i],[c,[p,R],[d,w]],[/droid.+; (glass) \d/i],[c,[p,O],[d,w]],[/(pico) (4|neo3(?: link|pro)?)/i],[p,c,[d,w]],[/; (quest( \d| pro)?)/i],[c,[p,j],[d,w]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[p,[d,g]],[/(aeobc)\b/i],[c,[p,P],[d,g]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[c,[d,v]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[c,[d,b]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[d,b]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[d,v]],[/(android[-\w\. ]{0,9});.+buil/i],[c,[p,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[h,[l,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[l,h],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[h,[l,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[l,h],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[h,l]],os:[[/microsoft (windows) (vista|xp)/i],[l,h],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[l,[h,Y,$]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[h,Y,$],[l,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[h,/_/g,"."],[l,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[l,q],[h,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[h,l],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[l,h],[/\(bb(10);/i],[h,[l,S]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[h,[l,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[h,[l,x+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[h,[l,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[h,[l,"watchOS"]],[/crkey\/([\d\.]+)/i],[h,[l,I+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[l,N],h],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[l,h],[/(sunos) ?([\w\.\d]*)/i],[[l,"Solaris"],h],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[l,h]]},X=function(e,t){if(typeof e===a&&(t=e,e=r),!(this instanceof X))return new X(e,t).getResult();var m=typeof i!==o&&i.navigator?i.navigator:r,y=e||(m&&m.userAgent?m.userAgent:""),w=m&&m.userAgentData?m.userAgentData:r,g=t?function(e,t){var i={};for(var r in e)t[r]&&t[r].length%2==0?i[r]=t[r].concat(e[r]):i[r]=e[r];return i}(Q,t):Q,P=m&&m.userAgent==y;return this.getBrowser=function(){var e,t={};return t[l]=r,t[h]=r,W.call(t,y,g.browser),t[u]=typeof(e=t[h])===s?e.replace(/[^\d\.]/g,"").split(".")[0]:r,P&&m&&m.brave&&typeof m.brave.isBrave==n&&(t[l]="Brave"),t},this.getCPU=function(){var e={};return e[f]=r,W.call(e,y,g.cpu),e},this.getDevice=function(){var e={};return e[p]=r,e[c]=r,e[d]=r,W.call(e,y,g.device),P&&!e[d]&&w&&w.mobile&&(e[d]=v),P&&"Macintosh"==e[c]&&m&&typeof m.standalone!==o&&m.maxTouchPoints&&m.maxTouchPoints>2&&(e[c]="iPad",e[d]=b),e},this.getEngine=function(){var e={};return e[l]=r,e[h]=r,W.call(e,y,g.engine),e},this.getOS=function(){var e={};return e[l]=r,e[h]=r,W.call(e,y,g.os),P&&!e[l]&&w&&w.platform&&"Unknown"!=w.platform&&(e[l]=w.platform.replace(/chrome os/i,N).replace(/macos/i,q)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return y},this.setUA=function(e){return y=typeof e===s&&e.length>500?V(e,500):e,this},this.setUA(y),this};X.VERSION="1.0.40",X.BROWSER=H([l,h,u]),X.CPU=H([f]),X.DEVICE=H([c,p,d,m,v,y,b,w,g]),X.ENGINE=X.OS=H([l,h]),e.exports&&(t=e.exports=X),t.UAParser=X;var J=typeof i!==o&&(i.jQuery||i.Zepto);if(J&&!J.ua){var Z=new X;J.ua=Z.getResult(),J.ua.get=function(){return Z.getUA()},J.ua.set=function(e){Z.setUA(e);var t=Z.getResult();for(var i in t)J.ua[i]=t[i]}}}("object"==typeof window?window:H)}(G,G.exports);var V=K(G.exports),W={$:"usd","€":"eur","£":"gbp","¥":"jpy","₽":"rub","₹":"inr",CHF:"chf",A$:"aud",C$:"cad",NZ$:"nzd",HK$:"hkd",S$:"sgd","₩":"krw","元":"cny","฿":"thb","₫":"vnd","₱":"php",RM:"myr","₨":"inr",kr:"dkk","zł":"pln","₴":"uah","Kč":"czk",lei:"ron",Ft:"huf","₺":"try","ج.م":"egp",EGP:"egp","د.إ":"aed","ر.س":"sar","د.ك":"kwd","ر.ق":"qar","د.ا":"jod",R$:"brl",CLP$:"clp",MX$:"mxn",AR$:"ars",R:"zar",KSh:"kes",N:"ngn","GH₵":"ghs",DA:"dzd",MAD:"mad"};var Y,$="https://js.stripe.com/v3",Q=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,X="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",J=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",i=document.createElement("script");i.src="".concat($).concat(t);var r=document.head||document.body;if(!r)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return r.appendChild(i),i},Z=null,ee=null,te=null,ie=function(e){return null!==Z?Z:(Z=new Promise((function(t,i){if("undefined"!=typeof window&&"undefined"!=typeof document)if(window.Stripe&&e&&console.warn(X),window.Stripe)t(window.Stripe);else try{var r=function(){for(var e=document.querySelectorAll('script[src^="'.concat($,'"]')),t=0;t<e.length;t++){var i=e[t];if(Q.test(i.src))return i}return null}();if(r&&e)console.warn(X);else if(r){if(r&&null!==te&&null!==ee){var n;r.removeEventListener("load",te),r.removeEventListener("error",ee),null===(n=r.parentNode)||void 0===n||n.removeChild(r),r=J(e)}}else r=J(e);te=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}}(t,i),ee=function(e){return function(){e(new Error("Failed to load Stripe.js"))}}(i),r.addEventListener("load",te),r.addEventListener("error",ee)}catch(e){return void i(e)}else t(null)}))).catch((function(e){return Z=null,Promise.reject(e)}))},re=!1,ne=function(){return Y||(Y=ie(null).catch((function(e){return Y=null,Promise.reject(e)})))};Promise.resolve().then((function(){return ne()})).catch((function(e){re||console.warn(e)}));var oe=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];re=!0;var r=Date.now();return ne().then((function(e){return function(e,t,i){if(null===e)return null;var r=e.apply(void 0,t);return function(e,t){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"4.6.0",startTime:t})}(r,i),r}(e,t,r)}))},ae={new:{form:"apphud-stripe-payment-form",payment:"stripe-payment-element",submit:"stripe-submit",error:"stripe-error-message",applePayButton:"apphud-apple-pay-button"},old:{form:"apphud-payment-form",payment:"payment-element",submit:"submit",error:"error-message"}},se=function(){function n(e,r,n,o){var s=this;this.user=e,this.providerId=r,this.accountId=n,this.formBuilder=o,this.stripe=null,this.elements=void 0,this.paymentElement=null,this.subscription=null,this.submit=null,this.submitReadyText="Subscribe",this.submitProcessingText="Please wait...",this.submitErrorText="Error occurred",this.customer=null,this.productBundle=null,this.currentProductId=null,this.elementIDs=ae.old,this.formElement=null,this.submitHandler=null,this.paymentRequest=null,this.applePayButtonHandler=null,this.applePayButton=null,l((function(){return t(s,void 0,void 0,(function(){var e,t;return i(this,(function(i){switch(i.label){case 0:return this.injectStyles(),e=a.stripeLiveKey,a.debug&&(e=a.stripeTestKey),t=this,[4,oe(e,{stripeAccount:this.accountId})];case 1:return t.stripe=i.sent(),[2]}}))}))}))}return n.prototype.injectStyles=function(){var e="apphud-stripe-styles";if(!document.getElementById(e)){var t="\n            .stripe-element-container {\n                padding: 10px 0;\n            }\n\n            #".concat(ae.new.payment,",\n            #").concat(ae.old.payment," {\n                width: 100%;\n            }\n            \n            #").concat(ae.new.applePayButton," {\n                background-color: black;\n                color: white;\n                border-radius: 5px;\n                padding: 10px;\n                height: 40px;\n                margin-bottom: 15px;\n                display: none;\n                width: 100%;\n                cursor: pointer;\n                border: none;\n            }\n        "),i=document.createElement("style");i.id=e,i.textContent=t,document.head.appendChild(i)}},n.prototype.displayError=function(e){var t=document.querySelector("#".concat(this.elementIDs.error));t&&(t.textContent=e)},n.prototype.show=function(e,r,n){return t(this,arguments,void 0,(function(e,t,r,n,o,a){var s,u;return void 0===n&&(n={}),i(this,(function(i){switch(i.label){case 0:if(this.productBundle=a||null,this.currentProductId=e,this.currentPaywallId=t,this.currentPlacementId=r,this.subscriptionOptions=o,this.formBuilder.emit("payment_form_initialized",{paymentProvider:"stripe",event:{selector:"#apphud-stripe-payment-form"}}),this.buttonStateSetter=n.buttonStateSetter,n.id)for(s in this.elementIDs={},ae.new)this.elementIDs[s]="".concat(n.id,"-").concat(ae.new[s]);else document.getElementById(ae.new.form)&&(this.elementIDs=ae.new);if(!n.applePay){if(!(u=document.querySelector("#".concat(this.elementIDs.submit))))return c('Submit button is required. Add <button id="'.concat(this.elementIDs.submit,'">Pay</button>')),[2];this.submit=u,this.setButtonState("loading"),""!==this.submit.innerText&&(this.submitReadyText=this.submit.innerText)}return[4,this.createCustomer(n)];case 1:return i.sent(),n.applePay||(this.initStripe(n),this.setupForm(n)),n.applePay&&this.initializeApplePay(n),[2]}}))}))},n.prototype.setButtonState=function(e){if(this.submit)if(this.buttonStateSetter&&"error"!==e)this.buttonStateSetter(e);else switch(e){case"loading":this.submit.setAttribute("disabled","disabled");break;case"ready":this.submit.removeAttribute("disabled"),this.submit.innerText=this.submitReadyText;break;case"processing":this.submit.setAttribute("disabled","disabled"),this.submit.innerText=this.submitProcessingText;break;case"error":this.submit.setAttribute("disabled","disabled"),this.submit.innerText=this.submitErrorText}else c("Submit button not found. Failed to set state:",e,!0)},n.prototype.createSubscription=function(r,n,o,a,s){return t(this,void 0,void 0,(function(){var t,l,d,p,f,m;return i(this,(function(i){switch(i.label){case 0:t=h(),l=e(e(e({product_id:r,paywall_id:n,placement_id:o,user_id:this.user.id,customer_id:a,payment_method_id:s},(null===(f=this.subscriptionOptions)||void 0===f?void 0:f.trialDays)&&{trial_period_days:this.subscriptionOptions.trialDays}),(null===(m=this.subscriptionOptions)||void 0===m?void 0:m.couponId)&&{discount_id:this.subscriptionOptions.couponId}),{metadata:e({},t&&{amplitude_id:t})}),i.label=1;case 1:return i.trys.push([1,3,,4]),u("Creating subscription for product:",r),d=this,[4,C.createSubscription(this.providerId,l)];case 2:return d.subscription=i.sent(),this.subscription?(u("Subscription created",this.subscription),[3,4]):(c("Failed to create subscription for product:",r),[2]);case 3:throw p=i.sent(),c("Network error creating subscription:",p),new Error("Failed to create subscription due to network error");case 4:return[2]}}))}))},n.prototype.createCustomer=function(r){return t(this,void 0,void 0,(function(){var t,n,o,a,s;return i(this,(function(i){switch(i.label){case 0:return t=["card","sepa_debit","bancontact"],n=(null===(s=r.stripePaymentMethods)||void 0===s?void 0:s.length)?r.stripePaymentMethods:t,u("Creating customer for user",this.user.id),o=h(),a=this,[4,C.createCustomer(this.providerId,{user_id:this.user.id,payment_methods:n,metadata:e({},o&&{amplitude_id:o})})];case 1:return a.customer=i.sent(),this.customer?(u("Customer created",this.customer),[2]):(c("Failed to create customer for user",this.user.id),[2])}}))}))},n.prototype.initializeApplePay=function(e){var r,n,o,a,s,l,p=this;if(this.stripe)if(this.productBundle){var h=0,f="usd",m="Subscription";if(null===(r=null==e?void 0:e.applePayConfig)||void 0===r?void 0:r.staticPrice){var v=e.applePayConfig.staticPrice;f=v.currency||"usd",h=v.amount||0,m=v.label||"Subscription"}else{if(!this.productBundle.properties)return void c("Bundle has no properties and no static price provided",!0);var b=(null===(n=null==e?void 0:e.applePayConfig)||void 0===n?void 0:n.priceMacro)||"new-price",y=d(this.productBundle.properties,b);if(!y)return void c("No price found for macro ".concat(b," in bundle properties"),!0);var w=parseFloat(y.replace(/[^0-9.]/g,""));if(isNaN(w))return void c("Failed to parse price from macro ".concat(b,": ").concat(y),!0);h=Math.round(100*w),f=function(e,t){if(void 0===t&&(t="usd"),!e)return t;var i=e.match(/[$€£¥₹₽₩₴₺฿₱₨₫元N]/);if(i&&i[0]){var r=i[0];return W[r]||t}for(var r in W)if(r.length>1){if(e.startsWith(r+" "))return W[r];if(e.startsWith(r)&&e.length>r.length&&/\d/.test(e.charAt(r.length)))return W[r]}return t}(y,"usd")}!(null===(o=null==e?void 0:e.applePayConfig)||void 0===o?void 0:o.staticPrice)&&this.productBundle.name&&(m=this.productBundle.name),this.paymentRequest=this.stripe.paymentRequest({country:"US",currency:f,total:{label:m,amount:h},requestPayerName:(null===(a=null==e?void 0:e.applePayConfig)||void 0===a?void 0:a.requestPayerName)||!1,requestPayerEmail:(null===(s=null==e?void 0:e.applePayConfig)||void 0===s?void 0:s.requestPayerEmail)||!1,requestPayerPhone:(null===(l=null==e?void 0:e.applePayConfig)||void 0===l?void 0:l.requestPayerPhone)||!1}),u("Setting up Apple Pay payment request"),this.paymentRequest.canMakePayment().then((function(t){var i;if(t&&t.applePay){(null===(i=null==e?void 0:e.applePayConfig)||void 0===i?void 0:i.onApplePayAvailable)&&e.applePayConfig.onApplePayAvailable(!0),p.formBuilder.emit("apple_pay_available",{paymentProvider:"stripe",event:{available:!0,buttonId:p.elementIDs.applePayButton}});var r=document.getElementById(p.elementIDs.applePayButton);r?(r.style.display="block",p.applePayButton=r,p.applePayButtonHandler=function(){var e;p.buttonStateSetter&&p.buttonStateSetter("processing"),null===(e=p.paymentRequest)||void 0===e||e.show()},p.applePayButton.addEventListener("click",p.applePayButtonHandler)):c("Apple Pay button element not found with ID: "+p.elementIDs.applePayButton,!0)}else u("Apple Pay not available on this device/browser")})).catch((function(e){c("Error checking Apple Pay availability:",e,!0)})),this.paymentRequest.on("paymentmethod",(function(r){return t(p,void 0,void 0,(function(){var t,n,o,a=this;return i(this,(function(i){switch(i.label){case 0:if(i.trys.push([0,4,,5]),!this.customer)throw t=new Error("Customer not initialized"),c("Apple Pay - Customer not initialized",t,!0),t;return[4,this.createSubscription(this.currentProductId,this.currentPaywallId,this.currentPlacementId,this.customer.id,r.paymentMethod.id)];case 1:return i.sent(),this.subscription?this.subscription.client_secret?[4,this.stripe.confirmCardPayment(this.subscription.client_secret,{payment_method:r.paymentMethod.id},{handleActions:!1})]:[3,3]:(t=new Error("Failed to create subscription"),c("🍎 Apple Pay [ERROR] - Failed to create subscription",t),r.complete("fail"),this.displayError("Failed to create subscription"),this.buttonStateSetter&&(this.buttonStateSetter("error"),setTimeout((function(){a.buttonStateSetter&&a.buttonStateSetter("ready")}),1500)),[2]);case 2:if(n=i.sent().error)return c("Apple Pay - 3DS verification failed:",n,!0),r.complete("fail"),this.displayError(n.message||"Payment confirmation failed"),this.buttonStateSetter&&(this.buttonStateSetter("error"),setTimeout((function(){a.buttonStateSetter&&a.buttonStateSetter("ready")}),1500)),this.formBuilder.emit("payment_failure",{paymentProvider:"stripe",event:{error:n}}),[2];i.label=3;case 3:return r.complete("success"),this.handleSuccessfulPayment(e),[3,5];case 4:return o=i.sent(),c("Apple Pay - Payment processing error:",o,!0),r.complete("fail"),this.displayError(o.message||"Payment failed"),this.buttonStateSetter&&(this.buttonStateSetter("error"),setTimeout((function(){a.buttonStateSetter&&a.buttonStateSetter("ready")}),1500)),this.formBuilder.emit("payment_failure",{paymentProvider:"stripe",event:{error:o}}),[3,5];case 5:return[2]}}))}))})),this.paymentRequest.on("cancel",(function(){p.buttonStateSetter&&p.buttonStateSetter("ready")}))}else c("Failed to initialize Apple Pay: Product bundle is missing",!0);else c("Failed to initialize Apple Pay: Stripe not initialized",!0)},n.prototype.initStripe=function(e){var t,i,r=this;if(!this.stripe)return c("Failed to initialize Stripe",!0),this.displayError("Failed to initialize payment form. Please try again."),void this.setButtonState("error");if(!this.customer)return c("Failed to initialize Stripe, customer not initialized",!0),this.displayError("Failed to initialize payment form. Please try again."),void this.setButtonState("error");var n=(null==e?void 0:e.stripeAppearance)&&{theme:e.stripeAppearance.theme,variables:e.stripeAppearance.variables,rules:e.stripeAppearance.rules,disableAnimations:e.stripeAppearance.disableAnimations,labels:e.stripeAppearance.labels},o={clientSecret:this.customer.client_secret,appearance:n,loader:"always"};this.elements=this.stripe.elements(o);var a=this.elements.create("payment",{layout:null===(t=null==e?void 0:e.stripeAppearance)||void 0===t?void 0:t.layout,wallets:{applePay:!1===(null===(i=null==e?void 0:e.applePayConfig)||void 0===i?void 0:i.showApplePayInPaymentElement)?"never":"auto"}}),s=document.getElementById(this.elementIDs.payment);s&&(s.innerHTML='<div class="stripe-element-container"></div>',a.mount("#".concat(this.elementIDs.payment," .stripe-element-container"))),this.paymentElement=a,a.on("ready",(function(e){r.setButtonState("ready"),r.formBuilder.emit("payment_form_ready",{paymentProvider:"stripe",event:e})})),a.on("change",(function(e){var t=document.querySelector("#".concat(r.elementIDs.error));t&&e.complete&&(t.textContent="")})),a.on("loaderror",(function(e){e.error&&(c("Failed to load payment form",e.error,!0),r.displayError("Failed to load payment form"),r.setButtonState("error"))}))},n.prototype.setupForm=function(e){return t(this,void 0,void 0,(function(){var r,n=this;return i(this,(function(o){return this.cleanupFormListeners(),(r=document.querySelector("#".concat(this.elementIDs.form)))?(this.formElement=r,this.submitHandler=function(r){return t(n,void 0,void 0,(function(){var t,n,o,a,s,u;return i(this,(function(i){switch(i.label){case 0:return r.preventDefault(),this.setButtonState("processing"),this.stripe?this.elements?[4,this.stripe.confirmSetup({elements:this.elements,confirmParams:{return_url:this.ensureHttpsUrl((null==e?void 0:e.successUrl)||window.location.href)},redirect:"if_required"})]:(c("Elements not initialized",!0),this.displayError("Failed to initialize payment form. Please try again."),[2]):(c("Stripe not initialized",!0),this.displayError("Failed to initialize payment form. Please try again."),[2]);case 1:if(t=i.sent(),n=t.error,o=t.setupIntent,n)return c("Failed to confirm setup",n,!0),this.setButtonState("ready"),this.displayError("Failed to process payment. Please try again."),this.formBuilder.emit("payment_failure",{paymentProvider:"stripe",event:{error:n}}),[2];i.label=2;case 2:return i.trys.push([2,4,,5]),a=o.payment_method,[4,this.createSubscription(this.currentProductId,this.currentPaywallId,this.currentPlacementId,this.customer.id,a)];case 3:return i.sent(),[3,5];case 4:return s=i.sent(),c("Subscription creation failed:",s),this.setButtonState("error"),this.displayError("Failed to create subscription. Please try again."),this.formBuilder.emit("payment_failure",{paymentProvider:"stripe",event:{error:s}}),[2];case 5:return this.subscription?this.subscription.client_secret?[4,this.stripe.confirmCardPayment(this.subscription.client_secret)]:[3,7]:(c("Failed to create subscription"),this.setButtonState("error"),this.displayError("Failed to create subscription. Please try again."),this.formBuilder.emit("payment_failure",{paymentProvider:"stripe",event:{error:new Error("Failed to create subscription")}}),[2]);case 6:if(u=i.sent().error)return c("Failed to confirm card payment",u,!0),this.setButtonState("error"),this.displayError("Failed to confirm payment. Please try again."),this.formBuilder.emit("payment_failure",{paymentProvider:"stripe",event:{error:u}}),[2];i.label=7;case 7:return this.handleSuccessfulPayment(e),[2]}}))}))},this.formElement.addEventListener("submit",this.submitHandler),[2]):(c("Payment form: no form provided",!0),[2])}))}))},n.prototype.handleSuccessfulPayment=function(e){var t,i=null===(t=this.subscription)||void 0===t?void 0:t.deep_link;i&&r(N,i,q),r(M,"stripe",q),setTimeout((function(){(null==e?void 0:e.onSuccess)?e.onSuccess():(null==e?void 0:e.successUrl)&&"undefined"!==e.successUrl?document.location.href=e.successUrl:document.location.href=a.baseSuccessURL+"/"+i}),a.redirectDelay)},n.prototype.cleanupFormListeners=function(){this.formElement&&this.submitHandler&&(this.formElement.removeEventListener("submit",this.submitHandler),this.submitHandler=null),this.applePayButton&&this.applePayButtonHandler&&(this.applePayButton.removeEventListener("click",this.applePayButtonHandler),this.applePayButtonHandler=null,this.applePayButton=null)},n.prototype.ensureHttpsUrl=function(e){return/^https?:\/\//i.test(e)?e:"https://".concat(e)},n}();function ue(e,t,i,r,n,o,a){try{var s=e[o](a),u=s.value}catch(e){return void i(e)}s.done?t(u):Promise.resolve(u).then(r,n)}function ce(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function le(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function de(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?le(Object(i),!0).forEach((function(t){ce(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):le(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function pe(e,t){if(null==e)return{};var i,r,n=function(e,t){if(null==e)return{};var i={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.includes(r))continue;i[r]=e[r]}return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)i=o[r],t.includes(i)||{}.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}function he(){he=function(){return t};var e,t={},i=Object.prototype,r=i.hasOwnProperty,n=Object.defineProperty||function(e,t,i){e[t]=i.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,i){return e[t]=i}}function l(e,t,i,r){var o=t&&t.prototype instanceof b?t:b,a=Object.create(o.prototype),s=new D(r||[]);return n(a,"_invoke",{value:I(e,i,s)}),a}function d(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var p="suspendedStart",h="suspendedYield",f="executing",m="completed",v={};function b(){}function y(){}function w(){}var g={};c(g,a,(function(){return this}));var P=Object.getPrototypeOf,_=P&&P(P(C([])));_&&_!==i&&r.call(_,a)&&(g=_);var k=w.prototype=b.prototype=Object.create(g);function S(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function i(n,o,a,s){var u=d(e[n],e,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==typeof l&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(l).then((function(e){c.value=e,a(c)}),(function(e){return i("throw",e,a,s)}))}s(u.arg)}var o;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){i(e,r,t,n)}))}return o=o?o.then(n,n):n()}})}function I(t,i,r){var n=p;return function(o,a){if(n===f)throw Error("Generator is already running");if(n===m){if("throw"===o)throw a;return{value:e,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var u=x(s,r);if(u){if(u===v)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===p)throw n=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=f;var c=d(t,i,r);if("normal"===c.type){if(n=r.done?m:h,c.arg===v)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=m,r.method="throw",r.arg=c.arg)}}}function x(t,i){var r=i.method,n=t.iterator[r];if(n===e)return i.delegate=null,"throw"===r&&t.iterator.return&&(i.method="return",i.arg=e,x(t,i),"throw"===i.method)||"return"!==r&&(i.method="throw",i.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var o=d(n,t.iterator,i.arg);if("throw"===o.type)return i.method="throw",i.arg=o.arg,i.delegate=null,v;var a=o.arg;return a?a.done?(i[t.resultName]=a.value,i.next=t.nextLoc,"return"!==i.method&&(i.method="next",i.arg=e),i.delegate=null,v):a:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,v)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function D(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function C(t){if(t||""===t){var i=t[a];if(i)return i.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function i(){for(;++n<t.length;)if(r.call(t,n))return i.value=t[n],i.done=!1,i;return i.value=e,i.done=!0,i};return o.next=o}}throw new TypeError(typeof t+" is not iterable")}return y.prototype=w,n(k,"constructor",{value:w,configurable:!0}),n(w,"constructor",{value:y,configurable:!0}),y.displayName=c(w,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,c(e,u,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},S(E.prototype),c(E.prototype,s,(function(){return this})),t.AsyncIterator=E,t.async=function(e,i,r,n,o){void 0===o&&(o=Promise);var a=new E(l(e,i,r,n),o);return t.isGeneratorFunction(i)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(k),c(k,u,"Generator"),c(k,a,(function(){return this})),c(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),i=[];for(var r in t)i.push(r);return i.reverse(),function e(){for(;i.length;){var r=i.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=C,D.prototype={constructor:D,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(A),!t)for(var i in this)"t"===i.charAt(0)&&r.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var i=this;function n(r,n){return s.type="throw",s.arg=t,i.next=r,n&&(i.method="next",i.arg=e),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&r.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),A(i),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var r=i.completion;if("throw"===r.type){var n=r.arg;A(i)}return n}}throw Error("illegal catch attempt")},delegateYield:function(t,i,r){return this.delegate={iterator:C(t),resultName:i,nextLoc:r},"next"===this.method&&(this.arg=e),v}},t}var fe="classic",me="v1",ve=me,be={url:"https://cdn.paddle.com/paddle/paddle.js"},ye={url:"https://cdn.paddle.com/paddle/v2/paddle.js"};var we={classic:void 0,v1:void 0},ge={classic:"PaddleClassic",v1:"PaddleBillingV1"};function Pe(e){var t,i=null===(t=function(e){if(e===fe)return be;return e===me?ye:void console.error("[Paddle] Unknown Paddle Version")}(e))||void 0===t?void 0:t.url;if(i){var r=we[e],n=ge[e];return void 0!==r?r:(we[e]=new Promise((function(t,r){if("undefined"!=typeof window)if(window[n]||window.Paddle)t(window[n]||window.Paddle);else try{var o=function(e){return document.querySelector('script[src="'.concat(e,'"]'))||void 0}(i);o||(o=function(e){var t=document.createElement("script");t.src=e;var i=document.head||document.body;if(!i)throw new Error("Cannot inject Paddle.js. It needs a <head> or <body> element.");return i.appendChild(t),t}(i)),o.addEventListener("load",(function(){window[n]||window.Paddle?t(window[n]||window.Paddle):r(new Error("Paddle.js not available"))})),o.addEventListener("error",(function(){r(new Error("Failed to load Paddle.js - ".concat(e)))}))}catch(e){return void r(e)}else t(void 0)})),we[e])}}var _e,ke,Se,Ee,Ie,xe=["environment","version"],Oe=["environment","version"];function Ae(e,t){var i=e.environment;e.version;var r=pe(e,xe);try{i&&t.Environment.set(i),t.Initialized?t.Update(de({},r)):t.Initialize(de({},r))}catch(e){console.warn("[Paddle] Paddle Initialization failed. Please check the inputs",e)}}function De(e,t){var i=e.environment;e.version;var r=pe(e,Oe);try{i&&t.Environment.set(i),t.Setup(de({},r))}catch(e){console.warn("[Paddle] Paddle Initialization failed. Please check the inputs",e)}}function Ce(e){return Te.apply(this,arguments)}function Te(){var e;return e=he().mark((function e(t){var i,r;return he().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(null==t?void 0:t.version)||ve,e.next=3,Pe(i);case 3:if(!(r=e.sent)){e.next=9;break}return t&&(i===me?Ae(t,r):i===fe&&De(t,r)),e.abrupt("return",r);case 9:return console.error("[Paddle] Error Loading Paddle"),e.abrupt("return");case 11:case"end":return e.stop()}}),e)})),Te=function(){var t=this,i=arguments;return new Promise((function(r,n){var o=e.apply(t,i);function a(e){ue(o,r,n,a,s,"next",e)}function s(e){ue(o,r,n,a,s,"throw",e)}a(void 0)}))},Te.apply(this,arguments)}!function(e){e.CHECKOUT_LOADED="checkout.loaded",e.CHECKOUT_CLOSED="checkout.closed",e.CHECKOUT_UPDATED="checkout.updated",e.CHECKOUT_COMPLETED="checkout.completed",e.CHECKOUT_ERROR="checkout.error",e.CHECKOUT_FAILED="checkout.failed",e.CHECKOUT_ITEMS_UPDATED="checkout.items.updated",e.CHECKOUT_ITEMS_REMOVED="checkout.items.removed",e.CHECKOUT_CUSTOMER_CREATED="checkout.customer.created",e.CHECKOUT_CUSTOMER_UPDATED="checkout.customer.updated",e.CHECKOUT_CUSTOMER_REMOVED="checkout.customer.removed",e.CHECKOUT_PAYMENT_SELECTED="checkout.payment.selected",e.CHECKOUT_PAYMENT_INITIATED="checkout.payment.initiated",e.CHECKOUT_PAYMENT_FAILED="checkout.payment.failed",e.CHECKOUT_DISCOUNT_APPLIED="checkout.discount.applied",e.CHECKOUT_DISCOUNT_REMOVED="checkout.discount.removed"}(_e||(_e={})),function(e){e.DAY="day",e.WEEK="week",e.MONTH="month",e.YEAR="year"}(ke||(ke={})),function(e){e.ALIPAY="alipay",e.APPLE_PAY="apple-pay",e.CARD="card",e.GOOGLE_PAY="google-pay",e.IDEAL="ideal",e.PAYPAL="paypal",e.WIRE_TRANSFER="wire-transfer",e.NONE="none"}(Se||(Se={})),function(e){e.AMERICAN_EXPRESS="american_express",e.DINERS_CLUB="diners_club",e.DISCOVER="discover",e.JCB="jcb",e.MADA="mada",e.MAESTRO="maestro",e.MASTER_CARD="mastercard",e.UNION_PAY="union_pay",e.VISA="visa",e.UNKNOWN="unknown"}(Ee||(Ee={})),function(e){e.DRAFT="draft",e.READY="ready",e.COMPLETED="completed",e.BILLED="billed",e.canceled="canceled",e.PAST_DUE="past_due"}(Ie||(Ie={}));var Ue=function(){function n(e,t,i){this.user=e,this.provider=t,this.formBuilder=i,this.paddle=null,this.currentOptions=null,this.subscription=null,this.initializePaddleInstance()}return n.prototype.initializePaddleInstance=function(){return t(this,void 0,void 0,(function(){var e,t,r,n=this;return i(this,(function(i){switch(i.label){case 0:if(i.trys.push([0,2,,3]),!this.provider.token)throw new Error("Missing Paddle provider token");return e=a.debug||this.user.is_sandbox?"sandbox":"production",t=this,[4,Ce({environment:e,token:this.provider.token,eventCallback:function(e){u("Paddle event received:",e.name),n.handlePaddleEvent(e,n.currentOptions)}})];case 1:if(t.paddle=i.sent(),!this.paddle)throw new Error("Paddle not initialized");return u("Paddle initialized successfully"),[3,3];case 2:return r=i.sent(),c("Failed to initialize Paddle",r,!0),[3,3];case 3:return[2]}}))}))},n.prototype.show=function(r,n,o){return t(this,arguments,void 0,(function(t,r,n,o,a){var s,l,d,p,h,f,m;return void 0===o&&(o={}),i(this,(function(i){switch(i.label){case 0:return this.currentOptions=o,[4,this.createSubscription(t,r,n,a)];case 1:return i.sent(),this.subscription?(u("Initializing Paddle payment form for product:",t),this.formBuilder.emit("payment_form_initialized",{paymentProvider:"paddle",event:{selector:"#".concat(null==o?void 0:o.id)}}),this.paddle?[3,3]:[4,this.initializePaddleInstance()]):(c("Failed to create subscription"),[2]);case 2:i.sent(),i.label=3;case 3:if(!this.paddle)return c("Paddle failed to initialize",!0),[2];if(s=(null==o?void 0:o.paddleSettings)||{},!(null===(p=this.currentOptions)||void 0===p?void 0:p.id))return c("Paddle form id is required",!0),[2];l={settings:{locale:this.user.locale||"en",displayMode:s.displayMode||"overlay",theme:s.theme||"light",variant:s.variant,frameTarget:null===(h=this.currentOptions)||void 0===h?void 0:h.id,frameInitialHeight:s.frameInitialHeight,frameStyle:s.frameStyle,allowedPaymentMethods:s.allowedPaymentMethods},customer:{id:null===(f=this.subscription)||void 0===f?void 0:f.customer_id}},d=(null===(m=this.subscription)||void 0===m?void 0:m.id)?e(e({},l),{transactionId:this.subscription.id}):e(e({},l),{items:[{priceId:t,quantity:1}]}),this.setButtonState("processing");try{if(!this.paddle)throw new Error("Paddle not initialized");this.paddle.Checkout.open(d)}catch(e){c("Failed to open Paddle checkout:",e,!0),this.setButtonState("ready"),s.errorCallback&&s.errorCallback(e instanceof Error?e.message:"Payment failed")}return this.setButtonState("ready"),this.formBuilder.emit("payment_form_ready",{paymentProvider:"paddle",event:{}}),[2]}}))}))},n.prototype.handlePaddleEvent=function(e,n){return t(this,void 0,void 0,(function(){var t,o,s,l,d,p;return i(this,(function(i){switch(e.name){case"checkout.completed":u("Payment completed successfully"),(t=null===(o=this.subscription)||void 0===o?void 0:o.deep_link)&&r(N,t,q),r(M,"paddle",q),this.formBuilder.emit("payment_success",{paymentProvider:"paddle",event:{user_id:this.user.id}}),setTimeout((function(){(null==n?void 0:n.onSuccess)?n.onSuccess():(null==n?void 0:n.successUrl)&&"undefined"!==n.successUrl?document.location.href=null==n?void 0:n.successUrl:document.location.href=a.baseSuccessURL+"/"+t}),a.redirectDelay);break;case"checkout.error":c("Payment failed:",e.data,!0),this.formBuilder.emit("payment_failure",{paymentProvider:"paddle",event:{error:e.data}}),this.setButtonState("ready"),(null===(l=null===(s=this.currentOptions)||void 0===s?void 0:s.paddleSettings)||void 0===l?void 0:l.errorCallback)&&this.currentOptions.paddleSettings.errorCallback("string"==typeof e.data?e.data:"Payment failed");break;case"checkout.loaded":u("Checkout loaded successfully"),this.setButtonState("ready"),this.formBuilder.emit("payment_form_ready",{paymentProvider:"paddle",event:{}});break;case"checkout.payment.failed":c("Payment failed",e.data,!0),this.formBuilder.emit("payment_failure",{paymentProvider:"paddle",event:{error:e.data}}),this.setButtonState("ready"),(null===(p=null===(d=this.currentOptions)||void 0===d?void 0:d.paddleSettings)||void 0===p?void 0:p.errorCallback)&&this.currentOptions.paddleSettings.errorCallback("string"==typeof e.data?e.data:"Payment failed")}return[2]}))}))},n.prototype.setButtonState=function(e){var t;(null===(t=this.currentOptions)||void 0===t?void 0:t.buttonStateSetter)&&this.currentOptions.buttonStateSetter(e)},n.prototype.createSubscription=function(r,n,o,a){return t(this,void 0,void 0,(function(){var t,s,l;return i(this,(function(i){switch(i.label){case 0:return t=h(),s=e(e({product_id:r,paywall_id:n,placement_id:o,user_id:this.user.id},(null==a?void 0:a.discountId)&&{discount_id:a.discountId}),{metadata:e({},t&&{amplitude_id:t})}),u("Creating subscription for product:",r),l=this,[4,C.createSubscription(this.provider.id,s)];case 1:return l.subscription=i.sent(),this.subscription?(u("Subscription created",this.subscription),[2]):(c("Failed to create subscription for product",r),[2])}}))}))},n}(),Be=function(){function e(e,t){this.provider=e,this.user=t,this.events={},this.currentForms=new Map}return e.prototype.getFormKey=function(e,t){var i="default";return"stripe"===e&&!0===t.applePay&&(i="apple_pay"),"".concat(e,":").concat(i)},e.prototype.show=function(e,r,n){return t(this,arguments,void 0,(function(e,t,r,n,o){var a,s,c,l,d;return void 0===n&&(n={}),i(this,(function(i){switch(i.label){case 0:switch(a=this.getFormKey(this.provider.kind,n),this.cleanup(a),c=null===(d=null==o?void 0:o.properties)||void 0===d?void 0:d.introductory_offer,this.provider.kind){case"stripe":l=c?{trialDays:c.stripe_free_trial_days?parseInt(c.stripe_free_trial_days):void 0,couponId:c.stripe_coupon_id}:void 0,s=new se(this.user,this.provider.id,this.provider.identifier,this),u("Start stripe form for account_id:",this.provider.identifier);break;case"paddle":l=c?{discountId:c.paddle_discount_id}:void 0,s=new Ue(this.user,this.provider,this),u("Start paddle form for account_id:",this.provider.identifier);break;default:throw new Error("Unsupported type "+this.provider.kind)}return this.currentForms.set(a,s),[4,s.show(e,t,r,n,l,o)];case 1:return i.sent(),[2]}}))}))},e.prototype.cleanup=function(e){if(e){var t=this.currentForms.get(e);t&&(t instanceof se&&t.cleanupFormListeners(),this.currentForms.delete(e))}else this.cleanupAll()},e.prototype.cleanupAll=function(){this.currentForms.forEach((function(e,t){e instanceof se&&e.cleanupFormListeners()})),this.currentForms.clear()},e.prototype.on=function(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)},e.prototype.emit=function(e,t){this.events[e]&&this.events[e].forEach((function(e){return e(t)}))},e}(),Le=function(){function n(e,t,i,r,n,o){this.user=e,this.providerId=t,this.paywallId=i,this.placementId=r,this.productId=n,this.upsellBuilder=o}return n.prototype.process=function(n,o){return t(this,void 0,void 0,(function(){var t,s,u,l;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),this.upsellBuilder.emit("upsell_initiated",{paymentProvider:"stripe",event:{paywallId:this.paywallId,placementId:this.placementId}}),t=h(),s={product_id:this.productId,paywall_id:this.paywallId,placement_id:this.placementId,user_id:this.user.id,upsell:!0,metadata:e({},t&&{amplitude_id:t})},(null==o?void 0:o.stripe_free_trial_days)&&(s.trial_period_days=parseInt(o.stripe_free_trial_days)),(null==o?void 0:o.stripe_coupon_id)&&(s.discount_id=o.stripe_coupon_id),[4,C.createSubscription(this.providerId,s)];case 1:if(!(u=i.sent()))throw new Error("Failed to create subscription");return u.deep_link&&r(N,u.deep_link,q),r(M,"stripe",q),this.upsellBuilder.emit("upsell_success",{paymentProvider:"stripe",event:{subscription:u}}),setTimeout((function(){(null==n?void 0:n.onSuccess)?n.onSuccess():(null==n?void 0:n.successUrl)&&"undefined"!==n.successUrl?document.location.href=n.successUrl:document.location.href=a.baseSuccessURL+"/"+u.deep_link}),a.redirectDelay),[2,!0];case 2:return l=i.sent(),c("Failed to process Stripe upsell:",l,!0),this.upsellBuilder.emit("upsell_failure",{paymentProvider:"stripe",event:{error:l}}),[2,!1];case 3:return[2]}}))}))},n}(),ze=function(){function n(e,t,i,r,n,o){this.user=e,this.provider=t,this.paywallId=i,this.placementId=r,this.productId=n,this.upsellBuilder=o,this.paddle=null,this.subscription=null,this.currentOptions=null}return n.prototype.process=function(e,n){return t(this,void 0,void 0,(function(){var t,o;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),this.currentOptions=e,this.upsellBuilder.emit("upsell_initiated",{paymentProvider:"paddle",event:{paywallId:this.paywallId,placementId:this.placementId}}),[4,this.createSubscription(n)];case 1:if(i.sent(),!this.subscription)throw new Error("Failed to create subscription");return this.subscription.deep_link&&r(N,this.subscription.deep_link,q),r(M,"paddle",q),[4,this.initializePaddleInstance()];case 2:if(i.sent(),!this.paddle)throw new Error("Failed to initialize Paddle");return t=this.buildCheckoutConfig(),u("Opening Paddle checkout with config:",t),this.paddle.Checkout.open(t),[2,!0];case 3:return o=i.sent(),c("Failed to process Paddle upsell:",o,!0),this.upsellBuilder.emit("upsell_failure",{paymentProvider:"paddle",event:{error:o}}),[2,!1];case 4:return[2]}}))}))},n.prototype.initializePaddleInstance=function(){return t(this,void 0,void 0,(function(){var e,t,r,n=this;return i(this,(function(i){switch(i.label){case 0:if(i.trys.push([0,2,,3]),!this.provider.token)throw new Error("Missing Paddle provider token");return e=a.debug||this.user.is_sandbox?"sandbox":"production",t=this,[4,Ce({environment:e,token:this.provider.token,eventCallback:function(e){u("Paddle event received:",e.name),n.handlePaddleEvent(e)}})];case 1:if(t.paddle=i.sent(),!this.paddle)throw new Error("Paddle not initialized");return u("Paddle initialized successfully for upsell"),[3,3];case 2:throw r=i.sent(),c("Failed to initialize Paddle for upsell",r,!0),r;case 3:return[2]}}))}))},n.prototype.handlePaddleEvent=function(e){var t=this;switch(e.name){case"checkout.completed":u("Paddle upsell payment completed successfully"),this.upsellBuilder.emit("upsell_success",{paymentProvider:"paddle",event:{subscription:this.subscription}}),setTimeout((function(){var e,i,r;(null===(e=t.currentOptions)||void 0===e?void 0:e.onSuccess)?t.currentOptions.onSuccess():(null===(i=t.currentOptions)||void 0===i?void 0:i.successUrl)&&"undefined"!==t.currentOptions.successUrl?document.location.href=t.currentOptions.successUrl:(null===(r=t.subscription)||void 0===r?void 0:r.deep_link)&&(document.location.href=a.baseSuccessURL+"/"+t.subscription.deep_link)}),a.redirectDelay);break;case"checkout.error":case"checkout.payment.failed":c("Paddle upsell payment failed:",e.data,!0),this.upsellBuilder.emit("upsell_failure",{paymentProvider:"paddle",event:{error:e.data}});break;case"checkout.loaded":u("Paddle upsell checkout loaded successfully")}},n.prototype.buildCheckoutConfig=function(){var t,i,r=(null===(t=this.currentOptions)||void 0===t?void 0:t.paddleSettings)||{},n={settings:{locale:this.user.locale||"en",displayMode:"overlay",theme:r.theme||"light",variant:r.variant||"multi-page",allowedPaymentMethods:r.allowedPaymentMethods}};if(!(null===(i=this.subscription)||void 0===i?void 0:i.id))throw new Error("Transaction ID is required for Paddle checkout");var o=e(e({},n),{transactionId:this.subscription.id});return this.subscription.auth_token?o.customerAuthToken=this.subscription.auth_token:this.subscription.customer_id&&(o.customer={id:this.subscription.customer_id}),this.subscription.payment_method&&(o.savedPaymentMethodId=this.subscription.payment_method),o},n.prototype.createSubscription=function(r){return t(this,void 0,void 0,(function(){var t,n,o;return i(this,(function(i){switch(i.label){case 0:return t=h(),n={product_id:this.productId,paywall_id:this.paywallId,placement_id:this.placementId,user_id:this.user.id,upsell:!0,metadata:e({},t&&{amplitude_id:t})},(null==r?void 0:r.paddle_discount_id)&&(n.discount_id=r.paddle_discount_id),u("Creating upsell subscription for product:",this.productId),o=this,[4,C.createSubscription(this.provider.id,n)];case 1:if(o.subscription=i.sent(),!this.subscription)throw c("Failed to create upsell subscription for product",this.productId),new Error("Failed to create subscription");return u("Upsell subscription created",this.subscription),[2]}}))}))},n}(),Fe=function(){function e(e,t,i,r,n,o){this.provider=e,this.user=t,this.paywallId=i,this.placementId=r,this.bundle=n,this.productId=o,this.events={},this.currentForm=null}return e.prototype.process=function(){return t(this,arguments,void 0,(function(e){var t,r,n,o;return void 0===e&&(e={}),i(this,(function(i){switch(i.label){case 0:r=null===(o=this.bundle.properties)||void 0===o?void 0:o.introductory_offer,i.label=1;case 1:switch(i.trys.push([1,3,,4]),this.provider.kind){case"stripe":t=new Le(this.user,this.provider.id,this.paywallId,this.placementId,this.productId,this),u("Processing Stripe upsell for account_id:",this.provider.identifier);break;case"paddle":t=new ze(this.user,this.provider,this.paywallId,this.placementId,this.productId,this),u("Processing Paddle upsell for account_id:",this.provider.identifier);break;default:throw new Error("Unsupported payment provider type: ".concat(this.provider.kind))}return this.currentForm=t,[4,t.process(e,r)];case 2:return[2,i.sent()];case 3:return n=i.sent(),c("Failed to process ".concat(this.provider.kind," upsell:"),n,!0),this.emit("upsell_failure",{paymentProvider:this.provider.kind,event:{error:n}}),[2,!1];case 4:return[2]}}))}))},e.prototype.on=function(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)},e.prototype.emit=function(e,t){this.events[e]&&this.events[e].forEach((function(e){return e(t)}))},e}(),Re=function(){function l(){this.placements=[],this.user=void 0,this.currentPaymentProviders=new Map,this._currentProducts=new Map,this._currentPlacement=void 0,this._currentPaywall=void 0,this._currentBundle=void 0,this.userID=void 0,this.hashedUserID=void 0,this.isReady=!1,this.queue=[],this.events={},this.eventQueue=[],this.isInitialized=!1,this.isPaywallShown=!1,this.reportedPlacementErrors=new Set,this.isUpsellPaywallShown=!1,this.formBuilders=new Map}return l.prototype.checkInitialization=function(){this.isInitialized||c("Apphud SDK not initialized",!0)},l.prototype.init=function(e){return t(this,void 0,void 0,(function(){var r,o,s=this;return i(this,(function(l){if(u("init",e),["your_api_key","your_api_key_here","YOUR-APPHUD-FLOW-KEY"].includes(e.apiKey))return c("You did not provide API Key for Web SDK. Check script tags inside body tag. Learn more: https://docs.apphud.com/docs/flow-builder",!0),[2];for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&(a[r]=e[r]);a.headers=C.baseHeaders();try{for(this.eventQueue=JSON.parse(n(L)||"[]"),o=0;o<this.eventQueue.length;o++)this.trackEvent(this.eventQueue[o])}catch(e){c(e)}return this.isInitialized=!0,m((function(){return t(s,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this.initializeApp(!0,!0)];case 1:return e.sent(),[2]}}))}))})),[2]}))}))},l.prototype.on=function(e,t){var i=this;return this.checkInitialization(),this.events[e]||(this.events[e]=[]),this.events[e].push(t),function(){i.events[e]&&(i.events[e]=i.events[e].filter((function(e){return e!==t})),0===i.events[e].length&&delete i.events[e])}},l.prototype.emit=function(e,t){this.events[e]&&this.events[e].forEach((function(e){return e(t)}))},l.prototype.getDeepLink=function(){return this.checkInitialization(),n(N)},l.prototype.getUserID=function(){if(this.checkInitialization(),this.userID&&a.disableCookies)return this.userID;var e=a.debug?B:U;return n(e)||void 0},l.prototype.reset=function(){return this.checkInitialization(),o(U),o(B),o(L),!0},l.prototype.track=function(e,t,i,r){var n=this;void 0===r&&(r=!1),this.checkInitialization();var o={name:e,properties:t||{},user_properties:i||{},timestamp:_(),insert_id:v()};return u("event",o),this.ready((function(){o.user_id=n.getUserID(),o.device_id=n.getUserID(),n.eventQueue.push(o),n.saveEventQueue(),setTimeout((function(){n.trackEvent(o,r)}),1e3)})),!0},l.prototype.setEmail=function(e){return t(this,void 0,void 0,(function(){var t;return i(this,(function(i){switch(i.label){case 0:return this.checkInitialization(),[4,this.createUser({email:e},!0)];case 1:return(t=i.sent())&&(this.user=t),[2]}}))}))},l.prototype.initializeApp=function(){return t(this,arguments,void 0,(function(e,t){var r;return void 0===e&&(e=!0),void 0===t&&(t=!1),i(this,(function(i){switch(i.label){case 0:return t?[4,this.createUser(null,!1)]:[3,2];case 1:(r=i.sent())&&(this.user=r),this.setPlacementsAndProducts(),this.setPaymentProvider(),i.label=2;case 2:return this.operateVariables(),this.operateAttribution(),this.setReady(e),[2]}}))}))},l.prototype.paymentForm=function(e,r){var n=this;this.checkInitialization(),this.ready((function(){return t(n,void 0,void 0,(function(){var t,n,o,a,s,l,d=this;return i(this,(function(i){switch(i.label){case 0:if((t=e||{}).paymentProvider){if(u("Looking for specified payment provider:",t.paymentProvider),!(n=this.currentPaymentProviders.get(t.paymentProvider)))return o="Requested payment provider ".concat(t.paymentProvider," not available"),c(o,!0),this.emit("".concat(t.paymentProvider,"_not_found"),{requestedProvider:t.paymentProvider,availableProviders:Array.from(this.currentPaymentProviders.keys())}),[2]}else n=Array.from(this.currentPaymentProviders.values())[0],u("Using first available payment provider:",null==n?void 0:n.kind);return n?(a=this.currentProductForProvider(n.kind))?this.currentPaywall()?this.currentPlacement()?(u("Initializing payment form with payment provider:",n),(s=r||a.base_plan_id)?this.user?((l=this.formBuilders.get(n.id))||(l=new Be(n,this.user),this.formBuilders.set(n.id,l)),["payment_form_initialized","payment_form_ready","payment_failure","payment_success"].forEach((function(e){l.on(e,(function(t){d.emit(e,t)})),"payment_form_ready"===e&&(void 0!==d._currentPaywall&&void 0!==d._currentPlacement?d.track("paywall_checkout_initiated",{paywall_id:d._currentPaywall.id,placement_id:d._currentPlacement.id},{}):c('Unable to track the "paywall_checkout_initiated" event: either paywall_id or placement_id is empty.',!0))})),u("Show payment form for product:",s),[4,l.show(s,this.currentPaywall().id,this.currentPlacement().id,t,this._currentBundle)]):(c("Payment form: no user",!0),[2]):(c("Unable to initialize the payment form because the product is absent.",!0),[2])):(c("Payment form: placement is required",!0),[2]):(c("Payment form: paywall is required",!0),[2]):(c("Payment form: product is required",!0),[2]):(c("No payment provider available",!0),[2]);case 1:return i.sent(),[2]}}))}))}))},l.prototype.selectPlacementProduct=function(e,t){var i;this.checkInitialization(),u("Save placement and bundle",e,t);var n=this.findPlacementByID(e);if(n&&0!==n.paywalls.length){var o=n.paywalls[0].items_v2[t];if(o)if(this.updateProductsAndProviders(o,(null===(i=this.user)||void 0===i?void 0:i.payment_providers)||[]))this.setCurrentItems(e,t),r(j,"".concat(e,",").concat(t),q),this.emit("product_changed",this.currentProduct());else c("Failed to set up payment providers for selected bundle",!0);else c("No product bundle found at index: "+t,!0)}else{c("No placement or paywall found for ID: "+e,!0)}},l.prototype.setCurrentItems=function(e,t){var i;if(this._currentPlacement=this.findPlacementByID(e),this._currentPlacement&&this._currentPlacement.paywalls.length>0){this._currentPaywall=this._currentPlacement.paywalls[0];var r=this._currentPaywall.items_v2[t];if(r){if(this._currentBundle=r,r.properties){var n=["new-price","old-price","full-price","discount","duration","custom-1","custom-2","custom-3"];if(!Object.values(r.properties).some((function(e){return n.some((function(t){return e[t]}))}))){var o='Placement with identifier "'.concat(e,'" was requested and found, but price macros are missing. Learn how to set up macros here: https://docs.apphud.com/docs/configure-web-placements#setting-up-product-macros');c(o,!0)}}if(r.products.length>0)this.updateProductsAndProviders(r,(null===(i=this.user)||void 0===i?void 0:i.payment_providers)||[])&&(u("Current placement",this._currentPlacement),u("Current paywall",this._currentPaywall),u("Current bundle",this._currentBundle),u("Current products",this._currentProducts),u("Current payment providers",this.currentPaymentProviders));else c("Bundle contains no products",!0)}}},l.prototype.updateProductsAndProviders=function(e,t){var i=this;if(this._currentProducts.clear(),this.currentPaymentProviders.clear(),e.products.forEach((function(e){var r=e.store,n=t.find((function(e){return e.kind===r}));if(n)i._currentProducts.set(r,e),i.currentPaymentProviders.set(r,n);else{var o="No compatible payment provider found for store type: ".concat(r);c(o,!0)}})),0===this.currentPaymentProviders.size){return c("No compatible payment providers found for any products in the bundle",!0),!1}return!0},l.prototype.setAttribution=function(e,t){this.checkInitialization(),u("SetAttribution",e,t),C.setAttribution(e,t).then((function(e){return u("Attribution set",e)}))},l.prototype.operateAttribution=function(){return t(this,void 0,void 0,(function(){var o,a,s=this;return i(this,(function(c){return u("Prepare Attribution"),o={},(a=new URLSearchParams).append("device_id",this.getUserID()),this.ready((function(){return t(s,void 0,void 0,(function(){var t,s,c,l,d,p,h,f;return i(this,(function(i){switch(i.label){case 0:return t=this.getQueryParamsAsJson(),(s=["ttclid","fbclid","gclid"]).forEach((function(e){t[e]&&a.append(e,t[e])})),c=this.prepareApphudAttributionData(),l=Object.entries(t).filter((function(e){var t=e[0];return!s.includes(t)})).reduce((function(e,t){var i=t[0],r=t[1];return e[i]=r,e}),{}),c&&(o.apphud_attribution_data=e(e({},c),l)),[4,this.retrieveGtagClientIDWithTimeout(5e3)];case 1:return(d=i.sent())&&(u("gtag client_id:",d),a.append("firebase_id",d)),void 0!==window.fbq&&(p=n("_fbp"),h=n("_fbc"),f=n("apphud_fb_external_id_sent"),p&&a.append("fbp",p),h&&a.append("fbc",h),this.hashedUserID&&!f&&(u("set external_id to fb: ",this.hashedUserID),window.fbq("trackCustom","ApphudInit",{external_id:this.hashedUserID}),r("apphud_fb_external_id_sent","true",z))),this.setAttribution(a.toString(),o),[2]}}))}))})),[2]}))}))},l.prototype.prepareApphudAttributionData=function(){return{user_agent:navigator.userAgent,referrer:document.location.origin+document.location.pathname}},l.prototype.retrieveGtagClientIDWithTimeout=function(e){return t(this,void 0,void 0,(function(){var t=this;return i(this,(function(i){return[2,new Promise((function(i){var r=!1,n=setTimeout((function(){r||(r=!0,i(null))}),e);t.waitForGtag().then((function(){var e=t.getGtagMeasurementId();if(!e)return console.warn("No Google Measurement ID found."),void i(null);void 0!==window.gtag?window.gtag("get",e,"client_id",(function(e){r||(r=!0,clearTimeout(n),i(e))})):i(null)})).catch((function(){console.warn("gtag.js did not load. Skipping attribution."),i(null)}))}))]}))}))},l.prototype.waitForGtag=function(){return new Promise((function(e,t){if(void 0===window.gtag)var i=0,r=setInterval((function(){i+=100,void 0!==window.gtag?(clearInterval(r),e()):i>=5e3&&(clearInterval(r),console.warn("gtag.js did not load within 5 seconds."),t())}),100);else e()}))},l.prototype.getGtagMeasurementId=function(){if(Array.isArray(window.dataLayer)){var e=window.dataLayer.find((function(e){return"config"===e[0]&&"string"==typeof e[1]&&e[1].startsWith("G-")}));if(e)return e[1]}return null},l.prototype.getQueryParamsAsJson=function(){var e=new URLSearchParams(window.location.search),t={};return e.forEach((function(e,i){t[i]?Array.isArray(t[i])?t[i].push(e):t[i]=[t[i],e]:t[i]=e})),t},l.prototype.setPaymentProvider=function(e){var t=this;this.ready((function(){var i,r=(null===(i=t.user)||void 0===i?void 0:i.payment_providers)||[];if(0!==r.length){var n=t._currentBundle;if(n)if(t.updateProductsAndProviders(n,r)&&e){var o=t.currentPaymentProviders.get(e);o&&t.emit("payment_provider_changed",{provider:o,reason:"user_selection"})}}}))},l.prototype.setLanguage=function(e){this.checkInitialization(),a.language=e},l.prototype.setPlacementsAndProducts=function(){var e=this;this.ready((function(){var t;e.placements=(null===(t=e.user)||void 0===t?void 0:t.placements)||[],u("Placements",e.placements);var i=e.getSavedPlacementBundleIndex();i.placementID&&e.setCurrentItems(i.placementID,i.bundleIndex)}))},l.prototype.setReady=function(e){var t;for(void 0===e&&(e=!1),u("set ready");t=this.queue.shift();)t();this.isReady=!0,e&&this.emit("ready",this)},l.prototype.saveEventQueue=function(){s&&r(L,JSON.stringify(this.eventQueue),1)},l.prototype.eventData=function(e){var t={events:[e],device_id:e.device_id,user_id:e.user_id};return delete e.device_id,delete e.user_id,t},l.prototype.trackEvent=function(e,r){var n=this;void 0===r&&(r=!1),this.ready((function(){return t(n,void 0,void 0,(function(){var t=this;return i(this,(function(i){return C.createEvent(this.eventData(e)).then((function(){for(var i=0;i<t.eventQueue.length;i++)if(t.eventQueue[i].id===e.id){t.eventQueue.splice(i,1);break}t.saveEventQueue(),t.initializeApp(!1,r)})),[2]}))}))}))},l.prototype.createUser=function(e,o){return t(this,void 0,void 0,(function(){var t,s,c;return i(this,(function(i){switch(i.label){case 0:return this.isReady=o,this.userID=this.getUserID(),t=this,[4,p(this.userID)];case 1:return t.hashedUserID=i.sent(),this.userID||(this.userID=v(),a.disableCookies||(n(T)||r(T,a.websiteVersion,z),s=a.debug?B:U,r(s,this.userID,z))),c=this.userParams({}),document.referrer.length>0&&(c.referrer=document.referrer),u("user",c),e&&(c=Object.assign(c,e)),[4,C.createUser(c)];case 2:return[2,i.sent()]}}))}))},l.prototype.userParams=function(t){var i,r,o=new V(navigator.userAgent);return e({user_id:this.userID,locale:b(),time_zone:y(),is_sandbox:a.debug,is_debug:a.debug,currency_code:w(),country_iso_code:g(),country_code:g(),device_id:this.userID,device_type:null!==(i=o.getDevice().model)&&void 0!==i?i:"unknown",device_family:null!==(r=o.getDevice().model)&&void 0!==r?r:"unknown",platform:"web2web",os_version:o.getOS().version||P(),app_version:a.websiteVersion,start_app_version:n(T)||a.websiteVersion,need_paywalls:!0,need_placements:!0,page_url:this.currentPage(),user_agent:navigator.userAgent},t)},l.prototype.currentPage=function(){return window.location.origin+window.location.pathname},l.prototype.operateVariables=function(){var e=this;this.checkInitialization(),this.ready((function(){var t=document.querySelectorAll("[".concat(F,"]")),i=document.querySelector("[".concat(R,"]"));if(i&&!e.isUpsellPaywallShown){var r=i.getAttribute(R);if(r){var n=e.findPlacementByID(r);if(n&&n.paywalls.length>0){var o=n.paywalls[0];e.track("paywall_shown",{paywall_id:o.id,placement_id:n.id,is_upsell:!0},{}),e.isUpsellPaywallShown=!0,u("Tracked upsell paywall shown event for placement:",r)}}}t.forEach((function(t){var i=t.getAttribute(F);if(i){var r=e.readVariableValueByKeyPath(i);if(u("Replace variable",i,r),r){if(i.endsWith("price")&&!e.isPaywallShown){var n=i.split(",").map((function(e){return e.trim()})),o=void 0;if(3===n.length)o=n[0];else o=e.getSavedPlacementBundleIndex().placementID;var a=e.findPlacementByID(o);if(a&&a.paywalls.length>0){var s=a.paywalls[0];e.track("paywall_shown",{paywall_id:s.id,placement_id:a.id},{}),e.isPaywallShown=!0}}t.innerHTML=r}}}))}))},l.prototype.getSavedPlacementBundleIndex=function(){var e=n(j);if(null!==e){var t=e.split(",").map((function(e){return e.trim()}));if(2===t.length)return{placementID:t[0],bundleIndex:parseInt(t[1])}}return{placementID:void 0,bundleIndex:0}},l.prototype.readVariableValueByKeyPath=function(e){var t=e.split(",").map((function(e){return e.trim()})),i=void 0,r=0,n=t[t.length-1];if(3==t.length)i=t[0],r=parseInt(t[1]),(null===i||r<0)&&(i=(o=this.getSavedPlacementBundleIndex()).placementID,r=o.bundleIndex);else if(1===t.length){var o;i=(o=this.getSavedPlacementBundleIndex()).placementID,r=o.bundleIndex}var a=this.findPlacementByID(i);if(!a)return u("placement not found with id: ",i),null;u("Placement",i,r);var s=a.paywalls[0].items_v2[r];return null!=s&&void 0!==s.properties?k(s.properties,n):null},l.prototype.findPlacementByID=function(e){var t=this.placements.find((function(t){return t.identifier===e}));if(!t&&!this.reportedPlacementErrors.has(e)){var i=this.placements.map((function(e){return e.identifier})),r='Requested placement with identifier "'.concat(e,'" but only these placements were found: [').concat(i.join(", "),"].");this.reportedPlacementErrors.add(e),c(r,!0)}return t},l.prototype.currentBundle=function(){if(this.checkInitialization(),this._currentBundle)return this._currentBundle;var e=this.currentPaywall();return null!=e&&e.items_v2[0]||null},l.prototype.currentProduct=function(){return this.checkInitialization(),Array.from(this._currentProducts.values())[0]||null},l.prototype.currentProductForProvider=function(e){return this.checkInitialization(),this._currentProducts.get(e)||null},l.prototype.currentProducts=function(){return this.checkInitialization(),new Map(this._currentProducts)},l.prototype.availableProviders=function(){return this.checkInitialization(),Array.from(this.currentPaymentProviders.keys())},l.prototype.currentPlacement=function(){if(this.checkInitialization(),this._currentPlacement)return this._currentPlacement;var e=this.placements[0];return null!=e?e:null},l.prototype.currentPaywall=function(){if(this.checkInitialization(),this._currentPaywall)return this._currentPaywall;var e=this.currentPlacement();return null!=e?e.paywalls[0]:null},l.prototype.ready=function(e){this.isReady?e():(u("not ready push to queue",e),this.queue.push(e))},l.prototype.getSuccessURL=function(){this.checkInitialization();var e=this.getDeepLink();return e?"".concat(a.baseSuccessURL,"/").concat(e):a.baseSuccessURL},l.prototype.createUpsellSubscription=function(e){return t(this,void 0,void 0,(function(){var t,r,o,a,s,l,d,p,h,f,m,v,b,y=this;return i(this,(function(i){switch(i.label){case 0:if(this.checkInitialization(),t=document.querySelector("[".concat(R,"]")),r=null,t&&(r=t.getAttribute(R),u("Found upsell button with placement ID:",r)),!r||this._currentPlacement&&this._currentPlacement.identifier===r||(u("Upsell placement is different from current placement, switching to upsell placement"),this.selectPlacementProduct(r,0)),o=this._currentPlacement,a=this._currentPaywall,s=this._currentBundle,l=this._currentProducts,!o||!a||!s)return c("No valid placement, paywall or bundle available. Call selectPlacementProduct first."),[2,!1];this.track("paywall_checkout_initiated",{paywall_id:a.id,placement_id:o.id,is_upsell:!0},{}),i.label=1;case 1:if(i.trys.push([1,3,,4]),!(null===(b=this.user)||void 0===b?void 0:b.id))return c("No user ID available"),[2,!1];if(!(d=n(M))){if(!((p=Array.from(this.currentPaymentProviders.keys())).length>0))return c("No payment providers available"),[2,!1];d=p[0],u("No payment provider cookie found, using first available provider:",d)}return h=this.currentPaymentProviders.get(d),f=l.get(d),h&&f?(m=new Fe(h,this.user,a.id,o.id,s,f.base_plan_id),["upsell_initiated","upsell_success","upsell_failure"].forEach((function(e){m.on(e,(function(t){y.emit(e,t)}))})),[4,m.process(e)]):(c("No payment provider or product available"),[2,!1]);case 2:return[2,i.sent()];case 3:return v=i.sent(),c("Failed to create upsell subscription:",v,!0),[2,!1];case 4:return[2]}}))}))},l}(),je=new Re;return window.ApphudSDK=je,je}));
=======
window.ApphudSDKVersion="2.0.0",function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).apphud=t()}(this,(function(){"use strict";var e=function(){return e=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},e.apply(this,arguments)};function t(e,t,i,r){return new(i||(i=Promise))((function(n,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))}function i(e,t){var i,r,n,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(i)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(i=1,r&&(n=2&s[0]?r.return:s[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,s[1])).done)return n;switch(r=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(n=o.trys,(n=n.length>0&&n[n.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){o.label=s[1];break}if(6===s[0]&&o.label<n[1]){o.label=n[1],n=s;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(s);break}n[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{i=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}"function"==typeof SuppressedError&&SuppressedError;var r=function(e,t,i){var r="";if(i){var n=new Date;n.setTime(n.getTime()+60*i*1e3),r="; expires="+n.toGMTString()}document.cookie=e+"="+encodeURIComponent(t)+r+"; path=/; samesite=lax"},n=function(e){var t,i,r=e+"=",n=document.cookie.split(";");for(t=0;t<n.length;t++){for(i=n[t];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(r))return decodeURIComponent(i.substring(r.length,i.length))}return null},o=function(e){r(e,"",-1)},a={apiKey:"",baseURL:"https://api.apphud.com/v1",baseSuccessURL:"https://getapp.apphud.com",debug:!1,websiteVersion:"0.0.1",httpRetriesCount:3,language:"en",httpRetryDelay:1e3,redirectDelay:1e3,headers:{},disableCookies:!1},s="undefined"!=typeof JSON&&void 0!==JSON.stringify,u=function(){for(var e,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];a.debug&&(e=window.console).log.apply(e,t)},c=function(){for(var e,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var r=!1;if(t.length>0&&"boolean"==typeof t[t.length-1]&&(r=t.pop()),(e=window.console).error.apply(e,t),r&&A.reportError){var n=t.map((function(e){if("object"==typeof e)try{return JSON.stringify(e)}catch(t){return String(e)}return String(e)})).join(" ");A.reportError(n).catch((function(e){console.error("Failed to report error to backend:",e)}))}},l=function(e){"interactive"===document.readyState||"complete"===document.readyState?setTimeout(e,0):document.addEventListener("DOMContentLoaded",e)},d=function(e){return t(void 0,void 0,void 0,(function(){var t,r,n;return i(this,(function(i){switch(i.label){case 0:return t=new TextEncoder,r=t.encode(e),[4,crypto.subtle.digest("SHA-256",r)];case 1:return n=i.sent(),[2,Array.from(new Uint8Array(n)).map((function(e){return e.toString(16).padStart(2,"0")})).join("")]}}))}))},p=function(){try{if("undefined"!=typeof window&&window.amplitude&&"function"==typeof window.amplitude.getDeviceId)return window.amplitude.getDeviceId()}catch(e){c("Error getting Amplitude device ID:",e)}return null},h=function(e){return new Promise((function(t){return setTimeout(t,e)}))},f=l,m=function(){return window.crypto&&window.crypto.randomUUID?window.crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},v=function(){return navigator.language},b=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},w=function(){var e=navigator.language;return new Intl.NumberFormat(e,{style:"currency",currency:"USD"}).resolvedOptions().currency},y=function(){var e=Intl.DateTimeFormat().resolvedOptions().locale;return(e.split("-")[1]||e.split("-")[0]).toUpperCase()},g=function(){var e=navigator.userAgent,t="Unknown OS Version";if(-1!==e.indexOf("Windows NT")){var i=e.match(/Windows NT (\d+\.\d+)/);i&&(t="Windows "+i[1])}else if(-1!==e.indexOf("Mac OS X")){var r=e.match(/Mac OS X (\d+_\d+(_\d+)?)/);r&&(t="macOS "+r[1].replace(/_/g,"."))}else if(-1!==e.indexOf("iPhone OS")||-1!==e.indexOf("iPad; CPU OS")){var n=e.match(/OS (\d+_\d+(_\d+)?)/);n&&(t="iOS "+n[1].replace(/_/g,"."))}else if(-1!==e.indexOf("Android")){var o=e.match(/Android (\d+\.\d+(\.\d+)?)/);o&&(t="Android "+o[1])}else-1!==e.indexOf("Linux")&&(t="Linux");return t},_=function(){return(new Date).getTime()/1e3},P=function(e,t){var i=e[a.language];if(i||(i=e.en),!i){var r=Object.keys(e);r.length>0&&(i=e[r[0]])}return i?t.split(".").reduce((function(e,t){return e&&e[t]}),i):null},k=function(){return a.baseURL+"/customers"},S=function(){return a.baseURL+"/events"},x=function(e){return a.baseURL+"/customers/attribution?"+e},I=function(e){return a.baseURL+"/payment_providers/:id/subscriptions".replace(":id",e)},E=function(e){return a.baseURL+"/payment_providers/:id/customers".replace(":id",e)},O=function(){return a.baseURL+"/analytics"},D=function(r,n,o){return t(void 0,void 0,void 0,(function(){function s(u){return t(this,void 0,void 0,(function(){var t,c,l,d,p;return i(this,(function(i){switch(i.label){case 0:t=a.httpRetryDelay||1e3,c=e({"Content-Type":"application/json; charset=utf-8",Authorization:"Bearer ".concat(a.apiKey)},a.headers),l={method:r,headers:c,credentials:"same-origin"},"POST"!==r&&"PUT"!==r||!o||(l.body=JSON.stringify(o)),i.label=1;case 1:return i.trys.push([1,4,,8]),[4,fetch(n,l)];case 2:if(!(d=i.sent()).ok)throw new Error("Network response was not ok");return[4,d.json()];case 3:return[2,i.sent()];case 4:return p=i.sent(),console.error("Attempt failed:",p),u<(a.httpRetriesCount||3)?[4,h(t)]:[3,6];case 5:return i.sent(),t*=2,[2,s(u+1)];case 6:throw console.error("All retries failed."),p;case 7:return[3,8];case 8:return[2]}}))}))}return i(this,(function(e){switch(e.label){case 0:return[4,s(0)];case 1:return[2,e.sent()]}}))}))},A={createUser:function(e){return t(void 0,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,D("POST",k(),e)];case 1:return[2,t.sent().data.results]}}))}))},createEvent:function(e){return t(void 0,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,D("POST",S(),e)];case 1:return[2,t.sent().data.results]}}))}))},baseHeaders:function(){return{"X-SDK":"web2web","X-SDK-VERSION":"2.0.0","X-Platform":"web2web","X-Store":"web2web","Content-Type":"application/json; charset=utf-8"}},createSubscription:function(e,r){return t(void 0,void 0,void 0,(function(){var t;return i(this,(function(i){switch(i.label){case 0:return[4,D("POST",I(e),r)];case 1:return(t=i.sent()).errors&&t.errors.length>0&&c("Subscription creation failed:",t.errors),[2,t.data.results]}}))}))},setAttribution:function(e,r){return t(void 0,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,D("POST",x(e),r)];case 1:return[2,t.sent().data.results]}}))}))},createCustomer:function(e,r){return t(void 0,void 0,void 0,(function(){var t;return i(this,(function(i){switch(i.label){case 0:return[4,D("POST",E(e),r)];case 1:return(t=i.sent()).errors&&t.errors.length>0&&c("Customer creation failed:",t.errors),[2,t.data.results]}}))}))},reportError:function(e){return t(void 0,void 0,void 0,(function(){var t;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,D("POST",O(),{error:e})];case 1:return i.sent(),[3,3];case 2:return t=i.sent(),c("Failed to report error to backend:",t),[3,3];case 3:return[2]}}))}))}},T="aph_start_version",C="aph_production_user_id",U="aph_debug_user_id",L="aph_events",z=1051200,B="data-aph-var",j="data-aph-upsell",F="aph_selected_bundle_index",N="aph_deep_link_url",R=1051200,M="aph_payment_provider",q="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function H(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var K={exports:{}};!function(e,t){!function(i,r){var n="function",o="undefined",a="object",s="string",u="major",c="model",l="name",d="type",p="vendor",h="version",f="architecture",m="console",v="mobile",b="tablet",w="smarttv",y="wearable",g="embedded",_="Amazon",P="Apple",k="ASUS",S="BlackBerry",x="Browser",I="Chrome",E="Firefox",O="Google",D="Huawei",A="LG",T="Microsoft",C="Motorola",U="Opera",L="Samsung",z="Sharp",B="Sony",j="Xiaomi",F="Zebra",N="Facebook",R="Chromium OS",M="Mac OS",q=" Browser",H=function(e){for(var t={},i=0;i<e.length;i++)t[e[i].toUpperCase()]=e[i];return t},K=function(e,t){return typeof e===s&&-1!==V(t).indexOf(V(e))},V=function(e){return e.toLowerCase()},G=function(e,t){if(typeof e===s)return e=e.replace(/^\s\s*/,""),typeof t===o?e:e.substring(0,500)},W=function(e,t){for(var i,o,s,u,c,l,d=0;d<t.length&&!c;){var p=t[d],h=t[d+1];for(i=o=0;i<p.length&&!c&&p[i];)if(c=p[i++].exec(e))for(s=0;s<h.length;s++)l=c[++o],typeof(u=h[s])===a&&u.length>0?2===u.length?typeof u[1]==n?this[u[0]]=u[1].call(this,l):this[u[0]]=u[1]:3===u.length?typeof u[1]!==n||u[1].exec&&u[1].test?this[u[0]]=l?l.replace(u[1],u[2]):r:this[u[0]]=l?u[1].call(this,l,u[2]):r:4===u.length&&(this[u[0]]=l?u[3].call(this,l.replace(u[1],u[2])):r):this[u]=l||r;d+=2}},Y=function(e,t){for(var i in t)if(typeof t[i]===a&&t[i].length>0){for(var n=0;n<t[i].length;n++)if(K(t[i][n],e))return"?"===i?r:i}else if(K(t[i],e))return"?"===i?r:i;return t.hasOwnProperty("*")?t["*"]:e},Q={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},X={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[h,[l,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[h,[l,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[l,h],[/opios[\/ ]+([\w\.]+)/i],[h,[l,U+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[h,[l,U+" GX"]],[/\bopr\/([\w\.]+)/i],[h,[l,U]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[h,[l,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[h,[l,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[l,h],[/quark(?:pc)?\/([-\w\.]+)/i],[h,[l,"Quark"]],[/\bddg\/([\w\.]+)/i],[h,[l,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[h,[l,"UC"+x]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[h,[l,"WeChat"]],[/konqueror\/([\w\.]+)/i],[h,[l,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[h,[l,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[h,[l,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[h,[l,"Smart Lenovo "+x]],[/(avast|avg)\/([\w\.]+)/i],[[l,/(.+)/,"$1 Secure "+x],h],[/\bfocus\/([\w\.]+)/i],[h,[l,E+" Focus"]],[/\bopt\/([\w\.]+)/i],[h,[l,U+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[h,[l,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[h,[l,"Dolphin"]],[/coast\/([\w\.]+)/i],[h,[l,U+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[h,[l,"MIUI"+q]],[/fxios\/([\w\.-]+)/i],[h,[l,E]],[/\bqihoobrowser\/?([\w\.]*)/i],[h,[l,"360"]],[/\b(qq)\/([\w\.]+)/i],[[l,/(.+)/,"$1Browser"],h],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[l,/(.+)/,"$1"+q],h],[/samsungbrowser\/([\w\.]+)/i],[h,[l,L+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[h,[l,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[l,"Sogou Mobile"],h],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[l,h],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[l],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[h,l],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[l,N],h],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[l,h],[/\bgsa\/([\w\.]+) .*safari\//i],[h,[l,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[h,[l,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[h,[l,I+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[l,I+" WebView"],h],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[h,[l,"Android "+x]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[l,h],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[h,[l,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[h,l],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[l,[h,Y,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[l,h],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[l,"Netscape"],h],[/(wolvic|librewolf)\/([\w\.]+)/i],[l,h],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[h,[l,E+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[l,[h,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[l,[h,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[f,"amd64"]],[/(ia32(?=;))/i],[[f,V]],[/((?:i[346]|x)86)[;\)]/i],[[f,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[f,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[f,"armhf"]],[/windows (ce|mobile); ppc;/i],[[f,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[f,/ower/,"",V]],[/(sun4\w)[;\)]/i],[[f,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[f,V]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[c,[p,L],[d,b]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[c,[p,L],[d,v]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[c,[p,P],[d,v]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[c,[p,P],[d,b]],[/(macintosh);/i],[c,[p,P]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[c,[p,z],[d,v]],[/(?:honor)([-\w ]+)[;\)]/i],[c,[p,"Honor"],[d,v]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[c,[p,D],[d,b]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[c,[p,D],[d,v]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[c,/_/g," "],[p,j],[d,v]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[c,/_/g," "],[p,j],[d,b]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[c,[p,"OPPO"],[d,v]],[/\b(opd2\d{3}a?) bui/i],[c,[p,"OPPO"],[d,b]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[c,[p,"Vivo"],[d,v]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[c,[p,"Realme"],[d,v]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[c,[p,C],[d,v]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[c,[p,C],[d,b]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[c,[p,A],[d,b]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[c,[p,A],[d,v]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[c,[p,"Lenovo"],[d,b]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[c,/_/g," "],[p,"Nokia"],[d,v]],[/(pixel c)\b/i],[c,[p,O],[d,b]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[c,[p,O],[d,v]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[c,[p,B],[d,v]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[c,"Xperia Tablet"],[p,B],[d,b]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[c,[p,"OnePlus"],[d,v]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[c,[p,_],[d,b]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[c,/(.+)/g,"Fire Phone $1"],[p,_],[d,v]],[/(playbook);[-\w\),; ]+(rim)/i],[c,p,[d,b]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[c,[p,S],[d,v]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[c,[p,k],[d,b]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[c,[p,k],[d,v]],[/(nexus 9)/i],[c,[p,"HTC"],[d,b]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[p,[c,/_/g," "],[d,v]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[c,[p,"TCL"],[d,b]],[/(itel) ((\w+))/i],[[p,V],c,[d,Y,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[c,[p,"Acer"],[d,b]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[c,[p,"Meizu"],[d,v]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[c,[p,"Ulefone"],[d,v]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[c,[p,"Energizer"],[d,v]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[c,[p,"Cat"],[d,v]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[c,[p,"Smartfren"],[d,v]],[/droid.+; (a(?:015|06[35]|142p?))/i],[c,[p,"Nothing"],[d,v]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[p,c,[d,v]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[p,c,[d,b]],[/(surface duo)/i],[c,[p,T],[d,b]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[c,[p,"Fairphone"],[d,v]],[/(u304aa)/i],[c,[p,"AT&T"],[d,v]],[/\bsie-(\w*)/i],[c,[p,"Siemens"],[d,v]],[/\b(rct\w+) b/i],[c,[p,"RCA"],[d,b]],[/\b(venue[\d ]{2,7}) b/i],[c,[p,"Dell"],[d,b]],[/\b(q(?:mv|ta)\w+) b/i],[c,[p,"Verizon"],[d,b]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[c,[p,"Barnes & Noble"],[d,b]],[/\b(tm\d{3}\w+) b/i],[c,[p,"NuVision"],[d,b]],[/\b(k88) b/i],[c,[p,"ZTE"],[d,b]],[/\b(nx\d{3}j) b/i],[c,[p,"ZTE"],[d,v]],[/\b(gen\d{3}) b.+49h/i],[c,[p,"Swiss"],[d,v]],[/\b(zur\d{3}) b/i],[c,[p,"Swiss"],[d,b]],[/\b((zeki)?tb.*\b) b/i],[c,[p,"Zeki"],[d,b]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[p,"Dragon Touch"],c,[d,b]],[/\b(ns-?\w{0,9}) b/i],[c,[p,"Insignia"],[d,b]],[/\b((nxa|next)-?\w{0,9}) b/i],[c,[p,"NextBook"],[d,b]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[p,"Voice"],c,[d,v]],[/\b(lvtel\-)?(v1[12]) b/i],[[p,"LvTel"],c,[d,v]],[/\b(ph-1) /i],[c,[p,"Essential"],[d,v]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[c,[p,"Envizen"],[d,b]],[/\b(trio[-\w\. ]+) b/i],[c,[p,"MachSpeed"],[d,b]],[/\btu_(1491) b/i],[c,[p,"Rotor"],[d,b]],[/(shield[\w ]+) b/i],[c,[p,"Nvidia"],[d,b]],[/(sprint) (\w+)/i],[p,c,[d,v]],[/(kin\.[onetw]{3})/i],[[c,/\./g," "],[p,T],[d,v]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[c,[p,F],[d,b]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[c,[p,F],[d,v]],[/smart-tv.+(samsung)/i],[p,[d,w]],[/hbbtv.+maple;(\d+)/i],[[c,/^/,"SmartTV"],[p,L],[d,w]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[p,A],[d,w]],[/(apple) ?tv/i],[p,[c,P+" TV"],[d,w]],[/crkey/i],[[c,I+"cast"],[p,O],[d,w]],[/droid.+aft(\w+)( bui|\))/i],[c,[p,_],[d,w]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[c,[p,z],[d,w]],[/(bravia[\w ]+)( bui|\))/i],[c,[p,B],[d,w]],[/(mitv-\w{5}) bui/i],[c,[p,j],[d,w]],[/Hbbtv.*(technisat) (.*);/i],[p,c,[d,w]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[p,G],[c,G],[d,w]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[d,w]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[p,c,[d,m]],[/droid.+; (shield) bui/i],[c,[p,"Nvidia"],[d,m]],[/(playstation [345portablevi]+)/i],[c,[p,B],[d,m]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[c,[p,T],[d,m]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[c,[p,L],[d,y]],[/((pebble))app/i],[p,c,[d,y]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[c,[p,P],[d,y]],[/droid.+; (glass) \d/i],[c,[p,O],[d,y]],[/droid.+; (wt63?0{2,3})\)/i],[c,[p,F],[d,y]],[/droid.+; (glass) \d/i],[c,[p,O],[d,y]],[/(pico) (4|neo3(?: link|pro)?)/i],[p,c,[d,y]],[/; (quest( \d| pro)?)/i],[c,[p,N],[d,y]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[p,[d,g]],[/(aeobc)\b/i],[c,[p,_],[d,g]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[c,[d,v]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[c,[d,b]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[d,b]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[d,v]],[/(android[-\w\. ]{0,9});.+buil/i],[c,[p,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[h,[l,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[l,h],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[h,[l,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[l,h],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[h,l]],os:[[/microsoft (windows) (vista|xp)/i],[l,h],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[l,[h,Y,Q]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[h,Y,Q],[l,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[h,/_/g,"."],[l,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[l,M],[h,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[h,l],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[l,h],[/\(bb(10);/i],[h,[l,S]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[h,[l,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[h,[l,E+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[h,[l,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[h,[l,"watchOS"]],[/crkey\/([\d\.]+)/i],[h,[l,I+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[l,R],h],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[l,h],[/(sunos) ?([\w\.\d]*)/i],[[l,"Solaris"],h],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[l,h]]},J=function(e,t){if(typeof e===a&&(t=e,e=r),!(this instanceof J))return new J(e,t).getResult();var m=typeof i!==o&&i.navigator?i.navigator:r,w=e||(m&&m.userAgent?m.userAgent:""),y=m&&m.userAgentData?m.userAgentData:r,g=t?function(e,t){var i={};for(var r in e)t[r]&&t[r].length%2==0?i[r]=t[r].concat(e[r]):i[r]=e[r];return i}(X,t):X,_=m&&m.userAgent==w;return this.getBrowser=function(){var e,t={};return t[l]=r,t[h]=r,W.call(t,w,g.browser),t[u]=typeof(e=t[h])===s?e.replace(/[^\d\.]/g,"").split(".")[0]:r,_&&m&&m.brave&&typeof m.brave.isBrave==n&&(t[l]="Brave"),t},this.getCPU=function(){var e={};return e[f]=r,W.call(e,w,g.cpu),e},this.getDevice=function(){var e={};return e[p]=r,e[c]=r,e[d]=r,W.call(e,w,g.device),_&&!e[d]&&y&&y.mobile&&(e[d]=v),_&&"Macintosh"==e[c]&&m&&typeof m.standalone!==o&&m.maxTouchPoints&&m.maxTouchPoints>2&&(e[c]="iPad",e[d]=b),e},this.getEngine=function(){var e={};return e[l]=r,e[h]=r,W.call(e,w,g.engine),e},this.getOS=function(){var e={};return e[l]=r,e[h]=r,W.call(e,w,g.os),_&&!e[l]&&y&&y.platform&&"Unknown"!=y.platform&&(e[l]=y.platform.replace(/chrome os/i,R).replace(/macos/i,M)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return w},this.setUA=function(e){return w=typeof e===s&&e.length>500?G(e,500):e,this},this.setUA(w),this};J.VERSION="1.0.40",J.BROWSER=H([l,h,u]),J.CPU=H([f]),J.DEVICE=H([c,p,d,m,v,w,b,y,g]),J.ENGINE=J.OS=H([l,h]),e.exports&&(t=e.exports=J),t.UAParser=J;var Z=typeof i!==o&&(i.jQuery||i.Zepto);if(Z&&!Z.ua){var $=new J;Z.ua=$.getResult(),Z.ua.get=function(){return $.getUA()},Z.ua.set=function(e){$.setUA(e);var t=$.getResult();for(var i in t)Z.ua[i]=t[i]}}}("object"==typeof window?window:q)}(K,K.exports);var V,G=H(K.exports),W="https://js.stripe.com/v3",Y=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,Q="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",X=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",i=document.createElement("script");i.src="".concat(W).concat(t);var r=document.head||document.body;if(!r)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return r.appendChild(i),i},J=null,Z=null,$=null,ee=function(e){return null!==J?J:(J=new Promise((function(t,i){if("undefined"!=typeof window&&"undefined"!=typeof document)if(window.Stripe&&e&&console.warn(Q),window.Stripe)t(window.Stripe);else try{var r=function(){for(var e=document.querySelectorAll('script[src^="'.concat(W,'"]')),t=0;t<e.length;t++){var i=e[t];if(Y.test(i.src))return i}return null}();if(r&&e)console.warn(Q);else if(r){if(r&&null!==$&&null!==Z){var n;r.removeEventListener("load",$),r.removeEventListener("error",Z),null===(n=r.parentNode)||void 0===n||n.removeChild(r),r=X(e)}}else r=X(e);$=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}}(t,i),Z=function(e){return function(){e(new Error("Failed to load Stripe.js"))}}(i),r.addEventListener("load",$),r.addEventListener("error",Z)}catch(e){return void i(e)}else t(null)}))).catch((function(e){return J=null,Promise.reject(e)}))},te=!1,ie=function(){return V||(V=ee(null).catch((function(e){return V=null,Promise.reject(e)})))};Promise.resolve().then((function(){return ie()})).catch((function(e){te||console.warn(e)}));var re=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];te=!0;var r=Date.now();return ie().then((function(e){return function(e,t,i){if(null===e)return null;var r=e.apply(void 0,t);return function(e,t){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"4.6.0",startTime:t})}(r,i),r}(e,t,r)}))},ne={new:{form:"apphud-stripe-payment-form",payment:"stripe-payment-element",submit:"stripe-submit",error:"stripe-error-message"},old:{form:"apphud-payment-form",payment:"payment-element",submit:"submit",error:"error-message"}},oe=function(){function n(e,r,n){var o=this;this.user=e,this.provider=r,this.formBuilder=n,this.stripe=null,this.elements=void 0,this.paymentElement=null,this.subscription=null,this.submit=null,this.submitReadyText="Subscribe",this.submitProcessingText="Please wait...",this.submitErrorText="Error occurred",this.customer=null,this.currentProductId=null,this.elementIDs=ne.old,this.formElement=null,this.submitHandler=null,l((function(){return t(o,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return this.injectStyles(),this.provider.token?(e=this,[4,re(this.provider.token,{stripeAccount:this.provider.identifier})]):(c("Missing Stripe provider token",!0),[2]);case 1:return e.stripe=t.sent(),[2]}}))}))}))}return n.prototype.injectStyles=function(){var e="apphud-stripe-styles";if(!document.getElementById(e)){var t="\n            .stripe-element-container {\n                padding: 10px 0;\n            }\n\n            #".concat(ne.new.payment,",\n            #").concat(ne.old.payment," {\n                width: 100%;\n            }\n        "),i=document.createElement("style");i.id=e,i.textContent=t,document.head.appendChild(i)}},n.prototype.displayError=function(e){var t=document.querySelector("#".concat(this.elementIDs.error));t&&(t.textContent=e)},n.prototype.show=function(e,r,n){return t(this,arguments,void 0,(function(e,t,r,n,o){var a,s;return void 0===n&&(n={}),i(this,(function(i){switch(i.label){case 0:if(this.currentProductId=e,this.currentPaywallId=t,this.currentPlacementId=r,this.subscriptionOptions=o,this.formBuilder.emit("payment_form_initialized",{paymentProvider:"stripe",event:{selector:"#apphud-stripe-payment-form"}}),this.buttonStateSetter=n.buttonStateSetter,n.id)for(a in this.elementIDs={},ne.new)this.elementIDs[a]="".concat(n.id,"-").concat(ne.new[a]);else document.getElementById(ne.new.form)&&(this.elementIDs=ne.new);return(s=document.querySelector("#".concat(this.elementIDs.submit)))?(this.submit=s,this.setButtonState("loading"),""!==this.submit.innerText&&(this.submitReadyText=this.submit.innerText),[4,this.createCustomer(n)]):(c('Submit button is required. Add <button id="'.concat(this.elementIDs.submit,'">Pay</button>')),[2]);case 1:return i.sent(),this.initStripe(n),this.setupForm(n),[2]}}))}))},n.prototype.setButtonState=function(e){if(this.submit)if(this.buttonStateSetter&&"error"!==e)this.buttonStateSetter(e);else switch(e){case"loading":this.submit.setAttribute("disabled","disabled");break;case"ready":this.submit.removeAttribute("disabled"),this.submit.innerText=this.submitReadyText;break;case"processing":this.submit.setAttribute("disabled","disabled"),this.submit.innerText=this.submitProcessingText;break;case"error":this.submit.setAttribute("disabled","disabled"),this.submit.innerText=this.submitErrorText}else c("Submit button not found. Failed to set state:",e,!0)},n.prototype.createSubscription=function(r,n,o,a,s){return t(this,void 0,void 0,(function(){var t,l,d,h,f,m;return i(this,(function(i){switch(i.label){case 0:t=p(),l=e(e(e({product_id:r,paywall_id:n,placement_id:o,user_id:this.user.id,customer_id:a,payment_method_id:s},(null===(f=this.subscriptionOptions)||void 0===f?void 0:f.trialDays)&&{trial_period_days:this.subscriptionOptions.trialDays}),(null===(m=this.subscriptionOptions)||void 0===m?void 0:m.couponId)&&{discount_id:this.subscriptionOptions.couponId}),{metadata:e({},t&&{amplitude_id:t})}),i.label=1;case 1:return i.trys.push([1,3,,4]),u("Creating subscription for product:",r),d=this,[4,A.createSubscription(this.provider.id,l)];case 2:return d.subscription=i.sent(),this.subscription?(u("Subscription created",this.subscription),[3,4]):(c("Failed to create subscription for product:",r),[2]);case 3:throw h=i.sent(),c("Network error creating subscription:",h),new Error("Failed to create subscription due to network error");case 4:return[2]}}))}))},n.prototype.createCustomer=function(r){return t(this,void 0,void 0,(function(){var t,n,o,a,s;return i(this,(function(i){switch(i.label){case 0:return t=["card","sepa_debit","bancontact"],n=(null===(s=r.stripePaymentMethods)||void 0===s?void 0:s.length)?r.stripePaymentMethods:t,u("Creating customer for user",this.user.id),o=p(),a=this,[4,A.createCustomer(this.provider.id,{user_id:this.user.id,payment_methods:n,metadata:e({},o&&{amplitude_id:o})})];case 1:return a.customer=i.sent(),this.customer?(u("Customer created",this.customer),[2]):(c("Failed to create customer for user",this.user.id),[2])}}))}))},n.prototype.initStripe=function(e){var t,i=this;if(!this.stripe)return c("Failed to initialize Stripe",!0),this.displayError("Failed to initialize payment form. Please try again."),void this.setButtonState("error");if(!this.customer)return c("Failed to initialize Stripe, customer not initialized",!0),this.displayError("Failed to initialize payment form. Please try again."),void this.setButtonState("error");var r=(null==e?void 0:e.stripeAppearance)&&{theme:e.stripeAppearance.theme,variables:e.stripeAppearance.variables,rules:e.stripeAppearance.rules,disableAnimations:e.stripeAppearance.disableAnimations,labels:e.stripeAppearance.labels},n={clientSecret:this.customer.client_secret,appearance:r,loader:"always"};this.elements=this.stripe.elements(n);var o=this.elements.create("payment",{layout:null===(t=null==e?void 0:e.stripeAppearance)||void 0===t?void 0:t.layout}),a=document.getElementById(this.elementIDs.payment);a&&(a.innerHTML='<div class="stripe-element-container"></div>',o.mount("#".concat(this.elementIDs.payment," .stripe-element-container"))),this.paymentElement=o,o.on("ready",(function(e){i.setButtonState("ready"),i.formBuilder.emit("payment_form_ready",{paymentProvider:"stripe",event:e})})),o.on("change",(function(e){var t=document.querySelector("#".concat(i.elementIDs.error));t&&e.complete&&(t.textContent="")})),o.on("loaderror",(function(e){e.error&&(c("Failed to load payment form",e.error,!0),i.displayError("Failed to load payment form"),i.setButtonState("error"))}))},n.prototype.setupForm=function(e){return t(this,void 0,void 0,(function(){var n,o=this;return i(this,(function(s){return this.cleanupFormListeners(),(n=document.querySelector("#".concat(this.elementIDs.form)))?(this.formElement=n,this.submitHandler=function(n){return t(o,void 0,void 0,(function(){var t,o,s,u,l,d,p;return i(this,(function(i){switch(i.label){case 0:return n.preventDefault(),this.setButtonState("processing"),this.stripe?this.elements?[4,this.stripe.confirmSetup({elements:this.elements,confirmParams:{return_url:this.ensureHttpsUrl((null==e?void 0:e.successUrl)||window.location.href)},redirect:"if_required"})]:(c("Elements not initialized",!0),this.displayError("Failed to initialize payment form. Please try again."),[2]):(c("Stripe not initialized",!0),this.displayError("Failed to initialize payment form. Please try again."),[2]);case 1:if(t=i.sent(),o=t.error,s=t.setupIntent,o)return c("Failed to confirm setup",o,!0),this.setButtonState("ready"),this.displayError("Failed to process payment. Please try again."),this.formBuilder.emit("payment_failure",{paymentProvider:"stripe",event:{error:o}}),[2];i.label=2;case 2:return i.trys.push([2,4,,5]),u=s.payment_method,[4,this.createSubscription(this.currentProductId,this.currentPaywallId,this.currentPlacementId,this.customer.id,u)];case 3:return i.sent(),[3,5];case 4:return l=i.sent(),c("Subscription creation failed:",l),this.setButtonState("error"),this.displayError("Failed to create subscription. Please try again."),this.formBuilder.emit("payment_failure",{paymentProvider:"stripe",event:{error:l}}),[2];case 5:return this.subscription?this.subscription.client_secret?[4,this.stripe.confirmCardPayment(this.subscription.client_secret)]:[3,7]:(c("Failed to create subscription"),this.setButtonState("error"),this.displayError("Failed to create subscription. Please try again."),this.formBuilder.emit("payment_failure",{paymentProvider:"stripe",event:{error:new Error("Failed to create subscription")}}),[2]);case 6:if(d=i.sent().error)return c("Failed to confirm card payment",d,!0),this.setButtonState("error"),this.displayError("Failed to confirm payment. Please try again."),this.formBuilder.emit("payment_failure",{paymentProvider:"stripe",event:{error:d}}),[2];i.label=7;case 7:return(p=this.subscription.deep_link)&&r(N,p,R),r(M,"stripe",R),setTimeout((function(){(null==e?void 0:e.onSuccess)?e.onSuccess():(null==e?void 0:e.successUrl)&&"undefined"!==e.successUrl?document.location.href=e.successUrl:document.location.href=a.baseSuccessURL+"/"+p}),a.redirectDelay),[2]}}))}))},this.formElement.addEventListener("submit",this.submitHandler),[2]):(c("Payment form: no form provided",!0),[2])}))}))},n.prototype.cleanupFormListeners=function(){this.formElement&&this.submitHandler&&(this.formElement.removeEventListener("submit",this.submitHandler),this.submitHandler=null)},n.prototype.ensureHttpsUrl=function(e){return/^https?:\/\//i.test(e)?e:"https://".concat(e)},n}();function ae(e,t,i,r,n,o,a){try{var s=e[o](a),u=s.value}catch(e){return void i(e)}s.done?t(u):Promise.resolve(u).then(r,n)}function se(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function ue(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function ce(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ue(Object(i),!0).forEach((function(t){se(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ue(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function le(e,t){if(null==e)return{};var i,r,n=function(e,t){if(null==e)return{};var i={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.includes(r))continue;i[r]=e[r]}return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)i=o[r],t.includes(i)||{}.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}function de(){de=function(){return t};var e,t={},i=Object.prototype,r=i.hasOwnProperty,n=Object.defineProperty||function(e,t,i){e[t]=i.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,i){return e[t]=i}}function l(e,t,i,r){var o=t&&t.prototype instanceof b?t:b,a=Object.create(o.prototype),s=new A(r||[]);return n(a,"_invoke",{value:I(e,i,s)}),a}function d(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var p="suspendedStart",h="suspendedYield",f="executing",m="completed",v={};function b(){}function w(){}function y(){}var g={};c(g,a,(function(){return this}));var _=Object.getPrototypeOf,P=_&&_(_(T([])));P&&P!==i&&r.call(P,a)&&(g=P);var k=y.prototype=b.prototype=Object.create(g);function S(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function i(n,o,a,s){var u=d(e[n],e,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==typeof l&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(l).then((function(e){c.value=e,a(c)}),(function(e){return i("throw",e,a,s)}))}s(u.arg)}var o;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){i(e,r,t,n)}))}return o=o?o.then(n,n):n()}})}function I(t,i,r){var n=p;return function(o,a){if(n===f)throw Error("Generator is already running");if(n===m){if("throw"===o)throw a;return{value:e,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var u=E(s,r);if(u){if(u===v)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===p)throw n=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=f;var c=d(t,i,r);if("normal"===c.type){if(n=r.done?m:h,c.arg===v)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=m,r.method="throw",r.arg=c.arg)}}}function E(t,i){var r=i.method,n=t.iterator[r];if(n===e)return i.delegate=null,"throw"===r&&t.iterator.return&&(i.method="return",i.arg=e,E(t,i),"throw"===i.method)||"return"!==r&&(i.method="throw",i.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var o=d(n,t.iterator,i.arg);if("throw"===o.type)return i.method="throw",i.arg=o.arg,i.delegate=null,v;var a=o.arg;return a?a.done?(i[t.resultName]=a.value,i.next=t.nextLoc,"return"!==i.method&&(i.method="next",i.arg=e),i.delegate=null,v):a:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,v)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function D(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function T(t){if(t||""===t){var i=t[a];if(i)return i.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function i(){for(;++n<t.length;)if(r.call(t,n))return i.value=t[n],i.done=!1,i;return i.value=e,i.done=!0,i};return o.next=o}}throw new TypeError(typeof t+" is not iterable")}return w.prototype=y,n(k,"constructor",{value:y,configurable:!0}),n(y,"constructor",{value:w,configurable:!0}),w.displayName=c(y,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,c(e,u,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},S(x.prototype),c(x.prototype,s,(function(){return this})),t.AsyncIterator=x,t.async=function(e,i,r,n,o){void 0===o&&(o=Promise);var a=new x(l(e,i,r,n),o);return t.isGeneratorFunction(i)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(k),c(k,u,"Generator"),c(k,a,(function(){return this})),c(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),i=[];for(var r in t)i.push(r);return i.reverse(),function e(){for(;i.length;){var r=i.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=T,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(D),!t)for(var i in this)"t"===i.charAt(0)&&r.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var i=this;function n(r,n){return s.type="throw",s.arg=t,i.next=r,n&&(i.method="next",i.arg=e),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&r.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),D(i),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var r=i.completion;if("throw"===r.type){var n=r.arg;D(i)}return n}}throw Error("illegal catch attempt")},delegateYield:function(t,i,r){return this.delegate={iterator:T(t),resultName:i,nextLoc:r},"next"===this.method&&(this.arg=e),v}},t}var pe="classic",he="v1",fe=he,me={url:"https://cdn.paddle.com/paddle/paddle.js"},ve={url:"https://cdn.paddle.com/paddle/v2/paddle.js"};var be={classic:void 0,v1:void 0},we={classic:"PaddleClassic",v1:"PaddleBillingV1"};function ye(e){var t,i=null===(t=function(e){if(e===pe)return me;return e===he?ve:void console.error("[Paddle] Unknown Paddle Version")}(e))||void 0===t?void 0:t.url;if(i){var r=be[e],n=we[e];return void 0!==r?r:(be[e]=new Promise((function(t,r){if("undefined"!=typeof window)if(window[n]||window.Paddle)t(window[n]||window.Paddle);else try{var o=function(e){return document.querySelector('script[src="'.concat(e,'"]'))||void 0}(i);o||(o=function(e){var t=document.createElement("script");t.src=e;var i=document.head||document.body;if(!i)throw new Error("Cannot inject Paddle.js. It needs a <head> or <body> element.");return i.appendChild(t),t}(i)),o.addEventListener("load",(function(){window[n]||window.Paddle?t(window[n]||window.Paddle):r(new Error("Paddle.js not available"))})),o.addEventListener("error",(function(){r(new Error("Failed to load Paddle.js - ".concat(e)))}))}catch(e){return void r(e)}else t(void 0)})),be[e])}}var ge,_e,Pe,ke,Se,xe=["environment","version"],Ie=["environment","version"];function Ee(e,t){var i=e.environment;e.version;var r=le(e,xe);try{i&&t.Environment.set(i),t.Initialized?t.Update(ce({},r)):t.Initialize(ce({},r))}catch(e){console.warn("[Paddle] Paddle Initialization failed. Please check the inputs",e)}}function Oe(e,t){var i=e.environment;e.version;var r=le(e,Ie);try{i&&t.Environment.set(i),t.Setup(ce({},r))}catch(e){console.warn("[Paddle] Paddle Initialization failed. Please check the inputs",e)}}function De(e){return Ae.apply(this,arguments)}function Ae(){var e;return e=de().mark((function e(t){var i,r;return de().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(null==t?void 0:t.version)||fe,e.next=3,ye(i);case 3:if(!(r=e.sent)){e.next=9;break}return t&&(i===he?Ee(t,r):i===pe&&Oe(t,r)),e.abrupt("return",r);case 9:return console.error("[Paddle] Error Loading Paddle"),e.abrupt("return");case 11:case"end":return e.stop()}}),e)})),Ae=function(){var t=this,i=arguments;return new Promise((function(r,n){var o=e.apply(t,i);function a(e){ae(o,r,n,a,s,"next",e)}function s(e){ae(o,r,n,a,s,"throw",e)}a(void 0)}))},Ae.apply(this,arguments)}!function(e){e.CHECKOUT_LOADED="checkout.loaded",e.CHECKOUT_CLOSED="checkout.closed",e.CHECKOUT_UPDATED="checkout.updated",e.CHECKOUT_COMPLETED="checkout.completed",e.CHECKOUT_ERROR="checkout.error",e.CHECKOUT_FAILED="checkout.failed",e.CHECKOUT_ITEMS_UPDATED="checkout.items.updated",e.CHECKOUT_ITEMS_REMOVED="checkout.items.removed",e.CHECKOUT_CUSTOMER_CREATED="checkout.customer.created",e.CHECKOUT_CUSTOMER_UPDATED="checkout.customer.updated",e.CHECKOUT_CUSTOMER_REMOVED="checkout.customer.removed",e.CHECKOUT_PAYMENT_SELECTED="checkout.payment.selected",e.CHECKOUT_PAYMENT_INITIATED="checkout.payment.initiated",e.CHECKOUT_PAYMENT_FAILED="checkout.payment.failed",e.CHECKOUT_DISCOUNT_APPLIED="checkout.discount.applied",e.CHECKOUT_DISCOUNT_REMOVED="checkout.discount.removed"}(ge||(ge={})),function(e){e.DAY="day",e.WEEK="week",e.MONTH="month",e.YEAR="year"}(_e||(_e={})),function(e){e.ALIPAY="alipay",e.APPLE_PAY="apple-pay",e.CARD="card",e.GOOGLE_PAY="google-pay",e.IDEAL="ideal",e.PAYPAL="paypal",e.WIRE_TRANSFER="wire-transfer",e.NONE="none"}(Pe||(Pe={})),function(e){e.AMERICAN_EXPRESS="american_express",e.DINERS_CLUB="diners_club",e.DISCOVER="discover",e.JCB="jcb",e.MADA="mada",e.MAESTRO="maestro",e.MASTER_CARD="mastercard",e.UNION_PAY="union_pay",e.VISA="visa",e.UNKNOWN="unknown"}(ke||(ke={})),function(e){e.DRAFT="draft",e.READY="ready",e.COMPLETED="completed",e.BILLED="billed",e.canceled="canceled",e.PAST_DUE="past_due"}(Se||(Se={}));var Te=function(){function n(e,t,i){this.user=e,this.provider=t,this.formBuilder=i,this.paddle=null,this.currentOptions=null,this.subscription=null,this.initializePaddleInstance()}return n.prototype.initializePaddleInstance=function(){return t(this,void 0,void 0,(function(){var e,t,r,n=this;return i(this,(function(i){switch(i.label){case 0:if(i.trys.push([0,2,,3]),!this.provider.token)throw new Error("Missing Paddle provider token");return e=a.debug||this.user.is_sandbox?"sandbox":"production",t=this,[4,De({environment:e,token:this.provider.token,eventCallback:function(e){u("Paddle event received:",e.name),n.handlePaddleEvent(e,n.currentOptions)}})];case 1:if(t.paddle=i.sent(),!this.paddle)throw new Error("Paddle not initialized");return u("Paddle initialized successfully"),[3,3];case 2:return r=i.sent(),c("Failed to initialize Paddle",r,!0),[3,3];case 3:return[2]}}))}))},n.prototype.show=function(r,n,o){return t(this,arguments,void 0,(function(t,r,n,o,a){var s,l,d,p,h,f,m;return void 0===o&&(o={}),i(this,(function(i){switch(i.label){case 0:return this.currentOptions=o,[4,this.createSubscription(t,r,n,a)];case 1:return i.sent(),this.subscription?(u("Initializing Paddle payment form for product:",t),this.formBuilder.emit("payment_form_initialized",{paymentProvider:"paddle",event:{selector:"#".concat(null==o?void 0:o.id)}}),this.paddle?[3,3]:[4,this.initializePaddleInstance()]):(c("Failed to create subscription"),[2]);case 2:i.sent(),i.label=3;case 3:if(!this.paddle)return c("Paddle failed to initialize",!0),[2];if(s=(null==o?void 0:o.paddleSettings)||{},!(null===(p=this.currentOptions)||void 0===p?void 0:p.id))return c("Paddle form id is required",!0),[2];l={settings:{locale:this.user.locale||"en",displayMode:s.displayMode||"overlay",theme:s.theme||"light",variant:s.variant,frameTarget:null===(h=this.currentOptions)||void 0===h?void 0:h.id,frameInitialHeight:s.frameInitialHeight,frameStyle:s.frameStyle,allowedPaymentMethods:s.allowedPaymentMethods},customer:{id:null===(f=this.subscription)||void 0===f?void 0:f.customer_id}},d=(null===(m=this.subscription)||void 0===m?void 0:m.id)?e(e({},l),{transactionId:this.subscription.id}):e(e({},l),{items:[{priceId:t,quantity:1}]}),this.setButtonState("processing");try{if(!this.paddle)throw new Error("Paddle not initialized");this.paddle.Checkout.open(d)}catch(e){c("Failed to open Paddle checkout:",e,!0),this.setButtonState("ready"),s.errorCallback&&s.errorCallback(e instanceof Error?e.message:"Payment failed")}return this.setButtonState("ready"),this.formBuilder.emit("payment_form_ready",{paymentProvider:"paddle",event:{}}),[2]}}))}))},n.prototype.handlePaddleEvent=function(e,n){return t(this,void 0,void 0,(function(){var t,o,s,l,d,p;return i(this,(function(i){switch(e.name){case"checkout.completed":u("Payment completed successfully"),(t=null===(o=this.subscription)||void 0===o?void 0:o.deep_link)&&r(N,t,R),r(M,"paddle",R),this.formBuilder.emit("payment_success",{paymentProvider:"paddle",event:{user_id:this.user.id}}),setTimeout((function(){(null==n?void 0:n.onSuccess)?n.onSuccess():(null==n?void 0:n.successUrl)&&"undefined"!==n.successUrl?document.location.href=null==n?void 0:n.successUrl:document.location.href=a.baseSuccessURL+"/"+t}),a.redirectDelay);break;case"checkout.error":c("Payment failed:",e.data,!0),this.formBuilder.emit("payment_failure",{paymentProvider:"paddle",event:{error:e.data}}),this.setButtonState("ready"),(null===(l=null===(s=this.currentOptions)||void 0===s?void 0:s.paddleSettings)||void 0===l?void 0:l.errorCallback)&&this.currentOptions.paddleSettings.errorCallback("string"==typeof e.data?e.data:"Payment failed");break;case"checkout.loaded":u("Checkout loaded successfully"),this.setButtonState("ready"),this.formBuilder.emit("payment_form_ready",{paymentProvider:"paddle",event:{}});break;case"checkout.payment.failed":c("Payment failed",e.data,!0),this.formBuilder.emit("payment_failure",{paymentProvider:"paddle",event:{error:e.data}}),this.setButtonState("ready"),(null===(p=null===(d=this.currentOptions)||void 0===d?void 0:d.paddleSettings)||void 0===p?void 0:p.errorCallback)&&this.currentOptions.paddleSettings.errorCallback("string"==typeof e.data?e.data:"Payment failed")}return[2]}))}))},n.prototype.setButtonState=function(e){var t;(null===(t=this.currentOptions)||void 0===t?void 0:t.buttonStateSetter)&&this.currentOptions.buttonStateSetter(e)},n.prototype.createSubscription=function(r,n,o,a){return t(this,void 0,void 0,(function(){var t,s,l;return i(this,(function(i){switch(i.label){case 0:return t=p(),s=e(e({product_id:r,paywall_id:n,placement_id:o,user_id:this.user.id},(null==a?void 0:a.discountId)&&{discount_id:a.discountId}),{metadata:e({},t&&{amplitude_id:t})}),u("Creating subscription for product:",r),l=this,[4,A.createSubscription(this.provider.id,s)];case 1:return l.subscription=i.sent(),this.subscription?(u("Subscription created",this.subscription),[2]):(c("Failed to create subscription for product",r),[2])}}))}))},n}(),Ce=function(){function e(e,t){this.provider=e,this.user=t,this.events={},this.currentForm=null}return e.prototype.show=function(e,r,n){return t(this,arguments,void 0,(function(e,t,r,n,o){var a,s,c,l;return void 0===n&&(n={}),i(this,(function(i){switch(i.label){case 0:switch(this.cleanup(),s=null===(l=null==o?void 0:o.properties)||void 0===l?void 0:l.introductory_offer,this.provider.kind){case"stripe":c=s?{trialDays:s.stripe_free_trial_days?parseInt(s.stripe_free_trial_days):void 0,couponId:s.stripe_coupon_id}:void 0,a=new oe(this.user,this.provider,this),u("Start stripe form for account_id:",this.provider.identifier);break;case"paddle":c=s?{discountId:s.paddle_discount_id}:void 0,a=new Te(this.user,this.provider,this),u("Start paddle form for account_id:",this.provider.identifier);break;default:throw new Error("Unsupported type "+this.provider.kind)}return this.currentForm=a,[4,a.show(e,t,r,n,c)];case 1:return i.sent(),[2]}}))}))},e.prototype.cleanup=function(){this.currentForm&&(this.currentForm instanceof oe&&this.currentForm.cleanupFormListeners(),this.currentForm=null)},e.prototype.on=function(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)},e.prototype.emit=function(e,t){this.events[e]&&this.events[e].forEach((function(e){return e(t)}))},e}(),Ue=function(){function n(e,t,i,r,n,o){this.user=e,this.providerId=t,this.paywallId=i,this.placementId=r,this.productId=n,this.upsellBuilder=o}return n.prototype.process=function(n,o){return t(this,void 0,void 0,(function(){var t,s,u,l;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),this.upsellBuilder.emit("upsell_initiated",{paymentProvider:"stripe",event:{paywallId:this.paywallId,placementId:this.placementId}}),t=p(),s={product_id:this.productId,paywall_id:this.paywallId,placement_id:this.placementId,user_id:this.user.id,upsell:!0,metadata:e({},t&&{amplitude_id:t})},(null==o?void 0:o.stripe_free_trial_days)&&(s.trial_period_days=parseInt(o.stripe_free_trial_days)),(null==o?void 0:o.stripe_coupon_id)&&(s.discount_id=o.stripe_coupon_id),[4,A.createSubscription(this.providerId,s)];case 1:if(!(u=i.sent()))throw new Error("Failed to create subscription");return u.deep_link&&r(N,u.deep_link,R),r(M,"stripe",R),this.upsellBuilder.emit("upsell_success",{paymentProvider:"stripe",event:{subscription:u}}),setTimeout((function(){(null==n?void 0:n.onSuccess)?n.onSuccess():(null==n?void 0:n.successUrl)&&"undefined"!==n.successUrl?document.location.href=n.successUrl:document.location.href=a.baseSuccessURL+"/"+u.deep_link}),a.redirectDelay),[2,!0];case 2:return l=i.sent(),c("Failed to process Stripe upsell:",l,!0),this.upsellBuilder.emit("upsell_failure",{paymentProvider:"stripe",event:{error:l}}),[2,!1];case 3:return[2]}}))}))},n}(),Le=function(){function n(e,t,i,r,n,o){this.user=e,this.provider=t,this.paywallId=i,this.placementId=r,this.productId=n,this.upsellBuilder=o,this.paddle=null,this.subscription=null,this.currentOptions=null}return n.prototype.process=function(e,n){return t(this,void 0,void 0,(function(){var t,o;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),this.currentOptions=e,this.upsellBuilder.emit("upsell_initiated",{paymentProvider:"paddle",event:{paywallId:this.paywallId,placementId:this.placementId}}),[4,this.createSubscription(n)];case 1:if(i.sent(),!this.subscription)throw new Error("Failed to create subscription");return this.subscription.deep_link&&r(N,this.subscription.deep_link,R),r(M,"paddle",R),[4,this.initializePaddleInstance()];case 2:if(i.sent(),!this.paddle)throw new Error("Failed to initialize Paddle");return t=this.buildCheckoutConfig(),u("Opening Paddle checkout with config:",t),this.paddle.Checkout.open(t),[2,!0];case 3:return o=i.sent(),c("Failed to process Paddle upsell:",o,!0),this.upsellBuilder.emit("upsell_failure",{paymentProvider:"paddle",event:{error:o}}),[2,!1];case 4:return[2]}}))}))},n.prototype.initializePaddleInstance=function(){return t(this,void 0,void 0,(function(){var e,t,r,n=this;return i(this,(function(i){switch(i.label){case 0:if(i.trys.push([0,2,,3]),!this.provider.token)throw new Error("Missing Paddle provider token");return e=a.debug||this.user.is_sandbox?"sandbox":"production",t=this,[4,De({environment:e,token:this.provider.token,eventCallback:function(e){u("Paddle event received:",e.name),n.handlePaddleEvent(e)}})];case 1:if(t.paddle=i.sent(),!this.paddle)throw new Error("Paddle not initialized");return u("Paddle initialized successfully for upsell"),[3,3];case 2:throw r=i.sent(),c("Failed to initialize Paddle for upsell",r,!0),r;case 3:return[2]}}))}))},n.prototype.handlePaddleEvent=function(e){var t=this;switch(e.name){case"checkout.completed":u("Paddle upsell payment completed successfully"),this.upsellBuilder.emit("upsell_success",{paymentProvider:"paddle",event:{subscription:this.subscription}}),setTimeout((function(){var e,i,r;(null===(e=t.currentOptions)||void 0===e?void 0:e.onSuccess)?t.currentOptions.onSuccess():(null===(i=t.currentOptions)||void 0===i?void 0:i.successUrl)&&"undefined"!==t.currentOptions.successUrl?document.location.href=t.currentOptions.successUrl:(null===(r=t.subscription)||void 0===r?void 0:r.deep_link)&&(document.location.href=a.baseSuccessURL+"/"+t.subscription.deep_link)}),a.redirectDelay);break;case"checkout.error":case"checkout.payment.failed":c("Paddle upsell payment failed:",e.data,!0),this.upsellBuilder.emit("upsell_failure",{paymentProvider:"paddle",event:{error:e.data}});break;case"checkout.loaded":u("Paddle upsell checkout loaded successfully")}},n.prototype.buildCheckoutConfig=function(){var t,i,r=(null===(t=this.currentOptions)||void 0===t?void 0:t.paddleSettings)||{},n={settings:{locale:this.user.locale||"en",displayMode:"overlay",theme:r.theme||"light",variant:r.variant||"multi-page",allowedPaymentMethods:r.allowedPaymentMethods}};if(!(null===(i=this.subscription)||void 0===i?void 0:i.id))throw new Error("Transaction ID is required for Paddle checkout");var o=e(e({},n),{transactionId:this.subscription.id});return this.subscription.auth_token?o.customerAuthToken=this.subscription.auth_token:this.subscription.customer_id&&(o.customer={id:this.subscription.customer_id}),this.subscription.payment_method&&(o.savedPaymentMethodId=this.subscription.payment_method),o},n.prototype.createSubscription=function(r){return t(this,void 0,void 0,(function(){var t,n,o;return i(this,(function(i){switch(i.label){case 0:return t=p(),n={product_id:this.productId,paywall_id:this.paywallId,placement_id:this.placementId,user_id:this.user.id,upsell:!0,metadata:e({},t&&{amplitude_id:t})},(null==r?void 0:r.paddle_discount_id)&&(n.discount_id=r.paddle_discount_id),u("Creating upsell subscription for product:",this.productId),o=this,[4,A.createSubscription(this.provider.id,n)];case 1:if(o.subscription=i.sent(),!this.subscription)throw c("Failed to create upsell subscription for product",this.productId),new Error("Failed to create subscription");return u("Upsell subscription created",this.subscription),[2]}}))}))},n}(),ze=function(){function e(e,t,i,r,n,o){this.provider=e,this.user=t,this.paywallId=i,this.placementId=r,this.bundle=n,this.productId=o,this.events={},this.currentForm=null}return e.prototype.process=function(){return t(this,arguments,void 0,(function(e){var t,r,n,o;return void 0===e&&(e={}),i(this,(function(i){switch(i.label){case 0:r=null===(o=this.bundle.properties)||void 0===o?void 0:o.introductory_offer,i.label=1;case 1:switch(i.trys.push([1,3,,4]),this.provider.kind){case"stripe":t=new Ue(this.user,this.provider.id,this.paywallId,this.placementId,this.productId,this),u("Processing Stripe upsell for account_id:",this.provider.identifier);break;case"paddle":t=new Le(this.user,this.provider,this.paywallId,this.placementId,this.productId,this),u("Processing Paddle upsell for account_id:",this.provider.identifier);break;default:throw new Error("Unsupported payment provider type: ".concat(this.provider.kind))}return this.currentForm=t,[4,t.process(e,r)];case 2:return[2,i.sent()];case 3:return n=i.sent(),c("Failed to process ".concat(this.provider.kind," upsell:"),n,!0),this.emit("upsell_failure",{paymentProvider:this.provider.kind,event:{error:n}}),[2,!1];case 4:return[2]}}))}))},e.prototype.on=function(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)},e.prototype.emit=function(e,t){this.events[e]&&this.events[e].forEach((function(e){return e(t)}))},e}(),Be=function(){function l(){this.placements=[],this.user=void 0,this.currentPaymentProviders=new Map,this._currentProducts=new Map,this._currentPlacement=void 0,this._currentPaywall=void 0,this._currentBundle=void 0,this.userID=void 0,this.hashedUserID=void 0,this.isReady=!1,this.queue=[],this.events={},this.eventQueue=[],this.isInitialized=!1,this.isPaywallShown=!1,this.reportedPlacementErrors=new Set,this.isUpsellPaywallShown=!1,this.currentFormBuilder=null}return l.prototype.checkInitialization=function(){this.isInitialized||c("Apphud SDK not initialized",!0)},l.prototype.init=function(e){return t(this,void 0,void 0,(function(){var r,o,s=this;return i(this,(function(l){if(u("init",e),["your_api_key","your_api_key_here","YOUR-APPHUD-FLOW-KEY"].includes(e.apiKey))return c("You did not provide API Key for Web SDK. Check script tags inside body tag. Learn more: https://docs.apphud.com/docs/flow-builder",!0),[2];for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&(a[r]=e[r]);a.headers=A.baseHeaders();try{for(this.eventQueue=JSON.parse(n(L)||"[]"),o=0;o<this.eventQueue.length;o++)this.trackEvent(this.eventQueue[o])}catch(e){c(e)}return this.isInitialized=!0,f((function(){return t(s,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this.initializeApp(!0,!0)];case 1:return e.sent(),[2]}}))}))})),[2]}))}))},l.prototype.on=function(e,t){var i=this;return this.checkInitialization(),this.events[e]||(this.events[e]=[]),this.events[e].push(t),function(){i.events[e]&&(i.events[e]=i.events[e].filter((function(e){return e!==t})),0===i.events[e].length&&delete i.events[e])}},l.prototype.emit=function(e,t){this.events[e]&&this.events[e].forEach((function(e){return e(t)}))},l.prototype.getDeepLink=function(){return this.checkInitialization(),n(N)},l.prototype.getUserID=function(){if(this.checkInitialization(),this.userID&&a.disableCookies)return this.userID;var e=a.debug?U:C;return n(e)||void 0},l.prototype.reset=function(){return this.checkInitialization(),o(C),o(U),o(L),!0},l.prototype.track=function(e,t,i,r){var n=this;void 0===r&&(r=!1),this.checkInitialization();var o={name:e,properties:t||{},user_properties:i||{},timestamp:_(),insert_id:m()};return u("event",o),this.ready((function(){o.user_id=n.getUserID(),o.device_id=n.getUserID(),n.eventQueue.push(o),n.saveEventQueue(),setTimeout((function(){n.trackEvent(o,r)}),1e3)})),!0},l.prototype.setEmail=function(e){return t(this,void 0,void 0,(function(){var t;return i(this,(function(i){switch(i.label){case 0:return this.checkInitialization(),[4,this.createUser({email:e},!0)];case 1:return(t=i.sent())&&(this.user=t),[2]}}))}))},l.prototype.initializeApp=function(){return t(this,arguments,void 0,(function(e,t){var r;return void 0===e&&(e=!0),void 0===t&&(t=!1),i(this,(function(i){switch(i.label){case 0:return t?[4,this.createUser(null,!1)]:[3,2];case 1:(r=i.sent())&&(this.user=r),this.setPlacementsAndProducts(),this.setPaymentProvider(),i.label=2;case 2:return this.operateVariables(),this.operateAttribution(),this.setReady(e),[2]}}))}))},l.prototype.paymentForm=function(e,r){var n=this;this.checkInitialization(),this.ready((function(){return t(n,void 0,void 0,(function(){var t,n,o,a,s,l,d=this;return i(this,(function(i){switch(i.label){case 0:if(this.currentFormBuilder&&this.currentFormBuilder.cleanup(),(t=e||{}).paymentProvider){if(u("Looking for specified payment provider:",t.paymentProvider),!(n=this.currentPaymentProviders.get(t.paymentProvider)))return o="Requested payment provider ".concat(t.paymentProvider," not available"),c(o,!0),this.emit("".concat(t.paymentProvider,"_not_found"),{requestedProvider:t.paymentProvider,availableProviders:Array.from(this.currentPaymentProviders.keys())}),[2]}else n=Array.from(this.currentPaymentProviders.values())[0],u("Using first available payment provider:",null==n?void 0:n.kind);return n?(a=this.currentProductForProvider(n.kind))?this.currentPaywall()?this.currentPlacement()?(u("Initializing payment form with payment provider:",n),(s=r||a.base_plan_id)?this.user?(l=new Ce(n,this.user),this.currentFormBuilder=l,["payment_form_initialized","payment_form_ready","payment_failure","payment_success"].forEach((function(e){l.on(e,(function(t){d.emit(e,t)})),"payment_form_ready"===e&&(void 0!==d._currentPaywall&&void 0!==d._currentPlacement?d.track("paywall_checkout_initiated",{paywall_id:d._currentPaywall.id,placement_id:d._currentPlacement.id},{}):c('Unable to track the "paywall_checkout_initiated" event: either paywall_id or placement_id is empty.',!0))})),u("Show payment form for product:",s),[4,l.show(s,this.currentPaywall().id,this.currentPlacement().id,t,this._currentBundle)]):(c("Payment form: no user",!0),[2]):(c("Unable to initialize the payment form because the product is absent.",!0),[2])):(c("Payment form: placement is required",!0),[2]):(c("Payment form: paywall is required",!0),[2]):(c("Payment form: product is required",!0),[2]):(c("No payment provider available",!0),[2]);case 1:return i.sent(),[2]}}))}))}))},l.prototype.selectPlacementProduct=function(e,t){var i;this.checkInitialization(),u("Save placement and bundle",e,t);var n=this.findPlacementByID(e);if(n&&0!==n.paywalls.length){var o=n.paywalls[0].items_v2[t];if(o)if(this.updateProductsAndProviders(o,(null===(i=this.user)||void 0===i?void 0:i.payment_providers)||[]))this.setCurrentItems(e,t),r(F,"".concat(e,",").concat(t),R),this.emit("product_changed",this.currentProduct());else c("Failed to set up payment providers for selected bundle",!0);else c("No product bundle found at index: "+t,!0)}else{c("No placement or paywall found for ID: "+e,!0)}},l.prototype.setCurrentItems=function(e,t){var i;if(this._currentPlacement=this.findPlacementByID(e),this._currentPlacement&&this._currentPlacement.paywalls.length>0){this._currentPaywall=this._currentPlacement.paywalls[0];var r=this._currentPaywall.items_v2[t];if(r){if(this._currentBundle=r,r.properties){var n=["new-price","old-price","full-price","discount","duration","custom-1","custom-2","custom-3"];if(!Object.values(r.properties).some((function(e){return n.some((function(t){return e[t]}))}))){var o='Placement with identifier "'.concat(e,'" was requested and found, but price macros are missing. Learn how to set up macros here: https://docs.apphud.com/docs/configure-web-placements#setting-up-product-macros');c(o,!0)}}if(r.products.length>0)this.updateProductsAndProviders(r,(null===(i=this.user)||void 0===i?void 0:i.payment_providers)||[])&&(u("Current placement",this._currentPlacement),u("Current paywall",this._currentPaywall),u("Current bundle",this._currentBundle),u("Current products",this._currentProducts),u("Current payment providers",this.currentPaymentProviders));else c("Bundle contains no products",!0)}}},l.prototype.updateProductsAndProviders=function(e,t){var i=this;if(this._currentProducts.clear(),this.currentPaymentProviders.clear(),e.products.forEach((function(e){var r=e.store,n=t.find((function(e){return e.kind===r}));if(n)i._currentProducts.set(r,e),i.currentPaymentProviders.set(r,n);else{var o="No compatible payment provider found for store type: ".concat(r);c(o,!0)}})),0===this.currentPaymentProviders.size){return c("No compatible payment providers found for any products in the bundle",!0),!1}return!0},l.prototype.setAttribution=function(e,t){this.checkInitialization(),u("SetAttribution",e,t),A.setAttribution(e,t).then((function(e){return u("Attribution set",e)}))},l.prototype.operateAttribution=function(){return t(this,void 0,void 0,(function(){var o,a,s=this;return i(this,(function(c){return u("Prepare Attribution"),o={},(a=new URLSearchParams).append("device_id",this.getUserID()),this.ready((function(){return t(s,void 0,void 0,(function(){var t,s,c,l,d,p,h,f;return i(this,(function(i){switch(i.label){case 0:return t=this.getQueryParamsAsJson(),(s=["ttclid","fbclid","gclid"]).forEach((function(e){t[e]&&a.append(e,t[e])})),c=this.prepareApphudAttributionData(),l=Object.entries(t).filter((function(e){var t=e[0];return!s.includes(t)})).reduce((function(e,t){var i=t[0],r=t[1];return e[i]=r,e}),{}),c&&(o.apphud_attribution_data=e(e({},c),l)),[4,this.retrieveGtagClientIDWithTimeout(5e3)];case 1:return(d=i.sent())&&(u("gtag client_id:",d),a.append("firebase_id",d)),void 0!==window.fbq&&(p=n("_fbp"),h=n("_fbc"),f=n("apphud_fb_external_id_sent"),p&&a.append("fbp",p),h&&a.append("fbc",h),this.hashedUserID&&!f&&(u("set external_id to fb: ",this.hashedUserID),window.fbq("trackCustom","ApphudInit",{external_id:this.hashedUserID}),r("apphud_fb_external_id_sent","true",z))),this.setAttribution(a.toString(),o),[2]}}))}))})),[2]}))}))},l.prototype.prepareApphudAttributionData=function(){return{user_agent:navigator.userAgent,referrer:document.location.origin+document.location.pathname}},l.prototype.retrieveGtagClientIDWithTimeout=function(e){return t(this,void 0,void 0,(function(){var t=this;return i(this,(function(i){return[2,new Promise((function(i){var r=!1,n=setTimeout((function(){r||(r=!0,i(null))}),e);t.waitForGtag().then((function(){var e=t.getGtagMeasurementId();if(!e)return console.warn("No Google Measurement ID found."),void i(null);void 0!==window.gtag?window.gtag("get",e,"client_id",(function(e){r||(r=!0,clearTimeout(n),i(e))})):i(null)})).catch((function(){console.warn("gtag.js did not load. Skipping attribution."),i(null)}))}))]}))}))},l.prototype.waitForGtag=function(){return new Promise((function(e,t){if(void 0===window.gtag)var i=0,r=setInterval((function(){i+=100,void 0!==window.gtag?(clearInterval(r),e()):i>=5e3&&(clearInterval(r),console.warn("gtag.js did not load within 5 seconds."),t())}),100);else e()}))},l.prototype.getGtagMeasurementId=function(){if(Array.isArray(window.dataLayer)){var e=window.dataLayer.find((function(e){return"config"===e[0]&&"string"==typeof e[1]&&e[1].startsWith("G-")}));if(e)return e[1]}return null},l.prototype.getQueryParamsAsJson=function(){var e=new URLSearchParams(window.location.search),t={};return e.forEach((function(e,i){t[i]?Array.isArray(t[i])?t[i].push(e):t[i]=[t[i],e]:t[i]=e})),t},l.prototype.setPaymentProvider=function(e){var t=this;this.ready((function(){var i,r=(null===(i=t.user)||void 0===i?void 0:i.payment_providers)||[];if(0!==r.length){var n=t._currentBundle;if(n)if(t.updateProductsAndProviders(n,r)&&e){var o=t.currentPaymentProviders.get(e);o&&t.emit("payment_provider_changed",{provider:o,reason:"user_selection"})}}}))},l.prototype.setLanguage=function(e){this.checkInitialization(),a.language=e},l.prototype.setPlacementsAndProducts=function(){var e=this;this.ready((function(){var t;e.placements=(null===(t=e.user)||void 0===t?void 0:t.placements)||[],u("Placements",e.placements);var i=e.getSavedPlacementBundleIndex();i.placementID&&e.setCurrentItems(i.placementID,i.bundleIndex)}))},l.prototype.setReady=function(e){var t;for(void 0===e&&(e=!1),u("set ready");t=this.queue.shift();)t();this.isReady=!0,e&&this.emit("ready",this)},l.prototype.saveEventQueue=function(){s&&r(L,JSON.stringify(this.eventQueue),1)},l.prototype.eventData=function(e){var t={events:[e],device_id:e.device_id,user_id:e.user_id};return delete e.device_id,delete e.user_id,t},l.prototype.trackEvent=function(e,r){var n=this;void 0===r&&(r=!1),this.ready((function(){return t(n,void 0,void 0,(function(){var t=this;return i(this,(function(i){return A.createEvent(this.eventData(e)).then((function(){for(var i=0;i<t.eventQueue.length;i++)if(t.eventQueue[i].id===e.id){t.eventQueue.splice(i,1);break}t.saveEventQueue(),t.initializeApp(!1,r)})),[2]}))}))}))},l.prototype.createUser=function(e,o){return t(this,void 0,void 0,(function(){var t,s,c;return i(this,(function(i){switch(i.label){case 0:return this.isReady=o,this.userID=this.getUserID(),t=this,[4,d(this.userID)];case 1:return t.hashedUserID=i.sent(),this.userID||(this.userID=m(),a.disableCookies||(n(T)||r(T,a.websiteVersion,z),s=a.debug?U:C,r(s,this.userID,z))),c=this.userParams({}),document.referrer.length>0&&(c.referrer=document.referrer),u("user",c),e&&(c=Object.assign(c,e)),[4,A.createUser(c)];case 2:return[2,i.sent()]}}))}))},l.prototype.userParams=function(t){var i,r,o=new G(navigator.userAgent);return e({user_id:this.userID,locale:v(),time_zone:b(),is_sandbox:a.debug,is_debug:a.debug,currency_code:w(),country_iso_code:y(),country_code:y(),device_id:this.userID,device_type:null!==(i=o.getDevice().model)&&void 0!==i?i:"unknown",device_family:null!==(r=o.getDevice().model)&&void 0!==r?r:"unknown",platform:"web2web",os_version:o.getOS().version||g(),app_version:a.websiteVersion,start_app_version:n(T)||a.websiteVersion,need_paywalls:!0,need_placements:!0,page_url:this.currentPage(),user_agent:navigator.userAgent},t)},l.prototype.currentPage=function(){return window.location.origin+window.location.pathname},l.prototype.operateVariables=function(){var e=this;this.checkInitialization(),this.ready((function(){var t=document.querySelectorAll("[".concat(B,"]")),i=document.querySelector("[".concat(j,"]"));if(i&&!e.isUpsellPaywallShown){var r=i.getAttribute(j);if(r){var n=e.findPlacementByID(r);if(n&&n.paywalls.length>0){var o=n.paywalls[0];e.track("paywall_shown",{paywall_id:o.id,placement_id:n.id,is_upsell:!0},{}),e.isUpsellPaywallShown=!0,u("Tracked upsell paywall shown event for placement:",r)}}}t.forEach((function(t){var i=t.getAttribute(B);if(i){var r=e.readVariableValueByKeyPath(i);if(u("Replace variable",i,r),r){if(i.endsWith("price")&&!e.isPaywallShown){var n=i.split(",").map((function(e){return e.trim()})),o=void 0;if(3===n.length)o=n[0];else o=e.getSavedPlacementBundleIndex().placementID;var a=e.findPlacementByID(o);if(a&&a.paywalls.length>0){var s=a.paywalls[0];e.track("paywall_shown",{paywall_id:s.id,placement_id:a.id},{}),e.isPaywallShown=!0}}t.innerHTML=r}}}))}))},l.prototype.getSavedPlacementBundleIndex=function(){var e=n(F);if(null!==e){var t=e.split(",").map((function(e){return e.trim()}));if(2===t.length)return{placementID:t[0],bundleIndex:parseInt(t[1])}}return{placementID:void 0,bundleIndex:0}},l.prototype.readVariableValueByKeyPath=function(e){var t=e.split(",").map((function(e){return e.trim()})),i=void 0,r=0,n=t[t.length-1];if(3==t.length)i=t[0],r=parseInt(t[1]),(null===i||r<0)&&(i=(o=this.getSavedPlacementBundleIndex()).placementID,r=o.bundleIndex);else if(1===t.length){var o;i=(o=this.getSavedPlacementBundleIndex()).placementID,r=o.bundleIndex}var a=this.findPlacementByID(i);if(!a)return u("placement not found with id: ",i),null;u("Placement",i,r);var s=a.paywalls[0].items_v2[r];return null!=s&&void 0!==s.properties?P(s.properties,n):null},l.prototype.findPlacementByID=function(e){var t=this.placements.find((function(t){return t.identifier===e}));if(!t&&!this.reportedPlacementErrors.has(e)){var i=this.placements.map((function(e){return e.identifier})),r='Requested placement with identifier "'.concat(e,'" but only these placements were found: [').concat(i.join(", "),"].");this.reportedPlacementErrors.add(e),c(r,!0)}return t},l.prototype.currentBundle=function(){if(this.checkInitialization(),this._currentBundle)return this._currentBundle;var e=this.currentPaywall();return null!=e&&e.items_v2[0]||null},l.prototype.currentProduct=function(){return this.checkInitialization(),Array.from(this._currentProducts.values())[0]||null},l.prototype.currentProductForProvider=function(e){return this.checkInitialization(),this._currentProducts.get(e)||null},l.prototype.currentProducts=function(){return this.checkInitialization(),new Map(this._currentProducts)},l.prototype.availableProviders=function(){return this.checkInitialization(),Array.from(this.currentPaymentProviders.keys())},l.prototype.currentPlacement=function(){if(this.checkInitialization(),this._currentPlacement)return this._currentPlacement;var e=this.placements[0];return null!=e?e:null},l.prototype.currentPaywall=function(){if(this.checkInitialization(),this._currentPaywall)return this._currentPaywall;var e=this.currentPlacement();return null!=e?e.paywalls[0]:null},l.prototype.ready=function(e){this.isReady?e():(u("not ready push to queue",e),this.queue.push(e))},l.prototype.getSuccessURL=function(){this.checkInitialization();var e=this.getDeepLink();return e?"".concat(a.baseSuccessURL,"/").concat(e):a.baseSuccessURL},l.prototype.createUpsellSubscription=function(e){return t(this,void 0,void 0,(function(){var t,r,o,a,s,l,d,p,h,f,m,v,b,w=this;return i(this,(function(i){switch(i.label){case 0:if(this.checkInitialization(),t=document.querySelector("[".concat(j,"]")),r=null,t&&(r=t.getAttribute(j),u("Found upsell button with placement ID:",r)),!r||this._currentPlacement&&this._currentPlacement.identifier===r||(u("Upsell placement is different from current placement, switching to upsell placement"),this.selectPlacementProduct(r,0)),o=this._currentPlacement,a=this._currentPaywall,s=this._currentBundle,l=this._currentProducts,!o||!a||!s)return c("No valid placement, paywall or bundle available. Call selectPlacementProduct first."),[2,!1];this.track("paywall_checkout_initiated",{paywall_id:a.id,placement_id:o.id,is_upsell:!0},{}),i.label=1;case 1:if(i.trys.push([1,3,,4]),!(null===(b=this.user)||void 0===b?void 0:b.id))return c("No user ID available"),[2,!1];if(!(d=n(M))){if(!((p=Array.from(this.currentPaymentProviders.keys())).length>0))return c("No payment providers available"),[2,!1];d=p[0],u("No payment provider cookie found, using first available provider:",d)}return h=this.currentPaymentProviders.get(d),f=l.get(d),h&&f?(m=new ze(h,this.user,a.id,o.id,s,f.base_plan_id),["upsell_initiated","upsell_success","upsell_failure"].forEach((function(e){m.on(e,(function(t){w.emit(e,t)}))})),[4,m.process(e)]):(c("No payment provider or product available"),[2,!1]);case 2:return[2,i.sent()];case 3:return v=i.sent(),c("Failed to create upsell subscription:",v,!0),[2,!1];case 4:return[2]}}))}))},l}(),je=new Be;return window.ApphudSDK=je,je}));
>>>>>>> master
